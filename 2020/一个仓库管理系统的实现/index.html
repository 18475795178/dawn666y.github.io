<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="Dawn">
  
  
  
  <link rel="prev" href="https://dawn666y.github.io/2020/%E4%BD%BF%E7%94%A8hugo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" />
  
  <link rel="canonical" href="https://dawn666y.github.io/2020/%E4%B8%80%E4%B8%AA%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           一个仓库管理系统的实现 | Dawn&#39;s vlog | Personal 
       
  </title>
  <meta name="title" content="一个仓库管理系统的实现 | Dawn&#39;s vlog | Personal ">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/dawn666y.github.io\/"
    },
    "articleSection" : "posts",
    "name" : "一个仓库管理系统的实现",
    "headline" : "一个仓库管理系统的实现",
    "description" : "一个来自bilibili的视频搭建的项目，这是搭建日志",
    "inLanguage" : "zh-CN",
    "author" : "Dawn",
    "creator" : "Dawn",
    "publisher": "Dawn",
    "accountablePerson" : "Dawn",
    "copyrightHolder" : "Dawn",
    "copyrightYear" : "2020",
    "datePublished": "2020-03-09 00:00:00 \x2b0000 UTC",
    "dateModified" : "2020-03-09 00:00:00 \x2b0000 UTC",
    "url" : "https:\/\/dawn666y.github.io\/2020\/%E4%B8%80%E4%B8%AA%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0\/",
    "wordCount" : "3683",
    "keywords" : [ "spring boot","shiro","thymeleaf","layui","mybatis plus", "Dawn\x27s vlog | Personal "]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://dawn666y.github.io/">Dawn&#39;s vlog | Personal </a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">博文</a>
                
                <a class="menu-item" href="/categories/" title="">分类</a>
                
                <a class="menu-item" href="/tags/" title="">标签</a>
                
                <a class="menu-item" href="/about/" title="">关于我</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://dawn666y.github.io/">Dawn&#39;s vlog | Personal </a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">博文</a>
                
                <a class="menu-item" href="/categories/" title="">分类</a>
                
                <a class="menu-item" href="/tags/" title="">标签</a>
                
                <a class="menu-item" href="/about/" title="">关于我</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">一个仓库管理系统的实现</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://dawn666y.github.io/" rel="author">Dawn</a> with ♥ 
                <span class="post-time">
                on <time datetime=2020-03-09 itemprop="datePublished">March 9, 2020</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://dawn666y.github.io/categories/%E5%BC%80%E5%8F%91/"> 开发 </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          <p><strong>tips:点击左上角的爱心 ❤️ 可切换夜间模式保护眼睛哦！！</strong></p>
<!-- raw HTML omitted -->
<ul>
<li><a href="#%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%90%AD%E5%BB%BA">仓库管理系统的搭建</a>
<ul>
<li><a href="#1-%E9%A1%B9%E7%9B%AE%E5%89%8D%E5%8F%B0%E6%A8%A1%E7%89%88%E7%9A%84%E4%BF%AE%E6%94%B9">1. 项目前台模版的修改</a>
<ul>
<li><a href="#11-%E6%9B%BF%E6%8D%A2-layuicms-%E4%B8%AD%E7%9A%84-layui-%E7%89%88%E6%9C%AC">1.1. 替换 layuicms 中的 layui 版本</a></li>
<li><a href="#12-%E6%9F%A5%E7%9C%8B%E9%A1%B5%E9%9D%A2%E6%98%AF%E5%90%A6%E5%AF%BC%E5%85%A5%E6%88%90%E5%8A%9F">1.2. 查看页面是否导入成功</a></li>
<li><a href="#13-%E5%88%A0%E9%99%A4-index-%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E5%86%85%E5%AE%B9">1.3. 删除 index 不需要的内容</a></li>
<li><a href="#14-%E4%BF%AE%E6%94%B9%E5%B7%A5%E4%BD%9C%E5%8F%B0-pagemainhtml">1.4. 修改工作台 page/main.html</a></li>
</ul>
</li>
<li><a href="#2-%E6%90%AD%E5%BB%BA-spring-boot-%E9%A1%B9%E7%9B%AE">2. 搭建 Spring Boot 项目</a>
<ul>
<li><a href="#21-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96">2.1. 引入依赖</a></li>
<li><a href="#22-yaml-%E9%85%8D%E7%BD%AE">2.2. yaml 配置</a></li>
<li><a href="#23-%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD">2.3. 实现登录功能</a>
<ul>
<li><a href="#231-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90">2.3.1. 代码生成</a></li>
<li><a href="#232-%E5%88%9B%E5%BB%BA-activeuser-%E7%B1%BB">2.3.2. 创建 ActiveUser 类</a></li>
<li><a href="#233-%E5%88%9B%E5%BB%BA-userrealm">2.3.3. 创建 UserRealm</a></li>
<li><a href="#234-%E9%85%8D%E7%BD%AE-shiro">2.3.4. 配置 shiro</a></li>
<li><a href="#235-%E7%BC%96%E5%86%99-logincontroller">2.3.5. 编写 LoginController</a></li>
<li><a href="#236-%E4%BF%AE%E6%94%B9%E5%89%8D%E5%8F%B0%E9%A1%B5%E9%9D%A2%E4%BB%A3%E7%A0%81">2.3.6. 修改前台页面代码</a></li>
</ul>
</li>
<li><a href="#24-%E7%94%9F%E6%88%90%E8%8F%9C%E5%8D%95">2.4. 生成菜单</a>
<ul>
<li><a href="#241-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90">2.4.1. 代码生成</a></li>
<li><a href="#242-%E5%BB%BA%E7%AB%8B-datagridview-%E7%B1%BB">2.4.2. 建立 DataGridView 类</a></li>
<li><a href="#243-%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%E6%88%90-json">2.4.3. 处理数据转换成 json</a></li>
<li><a href="#244-%E5%88%9B%E5%BB%BA-menucontroller">2.4.4. 创建 MenuController</a></li>
<li><a href="#245-%E4%BF%AE%E6%94%B9%E5%89%8D%E5%8F%B0%E9%A1%B5%E9%9D%A2">2.4.5. 修改前台页面</a></li>
</ul>
</li>
<li><a href="#25-%E4%BF%AE%E6%94%B9%E7%99%BB%E5%BD%95%E5%90%8E%E5%B7%A5%E4%BD%9C%E5%8F%B0">2.5. 修改登录后工作台</a></li>
<li><a href="#26-%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F">2.6. 日志管理系统</a>
<ul>
<li><a href="#261-%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81">2.6.1. 生成代码</a></li>
<li><a href="#262-%E7%BC%96%E5%86%99-loglogincontroller">2.6.2. 编写 LogLoginController</a></li>
<li><a href="#263-%E5%89%8D%E5%8F%B0%E9%A1%B5%E9%9D%A2%E5%92%8C-js">2.6.3. 前台页面和 js</a></li>
<li><a href="#264-%E5%85%B6%E5%AE%83%E4%BF%AE%E6%94%B9">2.6.4. 其它修改</a></li>
<li><a href="#265-%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93">2.6.5. 问题总结</a></li>
</ul>
</li>
<li><a href="#27-%E5%85%AC%E5%91%8A%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F">2.7. 公告管理系统</a></li>
<li><a href="#28-%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F">2.8. 部门管理系统</a></li>
<li><a href="#29-%E7%BC%93%E5%AD%98%E5%88%87%E9%9D%A2">2.9. 缓存切面</a></li>
<li><a href="#210-%E8%8F%9C%E5%8D%95%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F">2.10. 菜单管理系统</a></li>
<li><a href="#211-%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F">2.11. 权限管理系统</a></li>
<li><a href="#212-%E8%A7%92%E8%89%B2%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F">2.12. 角色管理系统</a></li>
<li><a href="#213-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F">2.13. 用户管理系统</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<p>本文为项目搭建日志</p>
<h1 id="仓库管理系统的搭建">仓库管理系统的搭建</h1>
<blockquote>
<p>项目来自哔哩哔哩雷哥的免费教学视频： <a href="https://www.bilibili.com/video/av69172830">【springboot+layui+mybatisplus+shiro】仓库管理系统【雷哥】</a>，我的项目源码：<a href="https://github.com/Dawn666Y/warehouse">warehouse</a>，请在阅读文档搭建项目的过程中结合源码来看</p>
</blockquote>
<h2 id="1-项目前台模版的修改">1. 项目前台模版的修改</h2>
<blockquote>
<p>使用 <strong>layui</strong> 框架来搭建页面，<strong>layui</strong> 是当下流行的对后端工程师友好的前端页面框架，具有==开箱即用==的特点，能够帮助后台开发者快速的搭建一个完善的页面。<!-- raw HTML omitted --><!-- raw HTML omitted -->本项目将使用开源项目 layuicms2.0 来完成页面布局<!-- raw HTML omitted -->github 地址：<a href="https://github.com/BrotherMa/layuicms2.0">layuicms2.0</a></p>
</blockquote>
<h3 id="11-替换-layuicms-中的-layui-版本">1.1. 替换 layuicms 中的 layui 版本</h3>
<p>layuicms2.0 默认使用 layui 版本为 <del>v2.2.5</del> ，我们将其更新为最新的 v2.5.6 ，要注意 layui/layui.js 和 layui/css/layui.css 中包含一些 layuicms 自带的内容，替换后要添加上。</p>
<ul>
<li>layui.js：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">//防止页面单独打开【登录页面除外】
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (
  <span style="color:#e6db74">/layuicms2.0\/page/</span>.<span style="color:#a6e22e">test</span>(<span style="color:#a6e22e">top</span>.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">href</span>) <span style="color:#f92672">&amp;&amp;</span>
  <span style="color:#f92672">!</span><span style="color:#e6db74">/login.html/</span>.<span style="color:#a6e22e">test</span>(<span style="color:#a6e22e">top</span>.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">href</span>)
) {
  <span style="color:#a6e22e">top</span>.window.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">href</span> <span style="color:#f92672">=</span>
    window.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">href</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;layuicms2.0/page/&#34;</span>)[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;layuicms2.0/&#34;</span>;
}
<span style="color:#75715e">//外部图标链接
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">iconUrl</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://at.alicdn.com/t/font_400842_q6tk84n9ywvu0udi.css&#34;</span>;
</code></pre></div><ul>
<li>layui.css：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="color:#75715e">/* 自添加样式*/</span>
@<span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#34;https://at.alicdn.com/t/font_400842_q6tk84n9ywvu0udi.css&#34;</span>;
.<span style="color:#a6e22e">layui-icon</span> {
  <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">16</span><span style="color:#66d9ef">px</span> <span style="color:#75715e">!important</span>;
}
.<span style="color:#a6e22e">mag0</span> {
  <span style="color:#66d9ef">margin</span>: <span style="color:#ae81ff">0</span> <span style="color:#75715e">!important</span>;
}
::<span style="color:#a6e22e">selection</span> {
  <span style="color:#66d9ef">background</span>: <span style="color:#ae81ff">#ff5722</span>;
  <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#fff</span>;
}
.<span style="color:#a6e22e">layui-red</span> {
  <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#f00</span> <span style="color:#75715e">!important</span>;
  <span style="color:#66d9ef">font-weight</span>: <span style="color:#66d9ef">bold</span>;
}
.<span style="color:#a6e22e">layui-blue</span> {
  <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#01aaed</span> <span style="color:#75715e">!important</span>;
}
</code></pre></div><blockquote>
<p>注意：作者在界面中均添加了版权开源声明公告，该内容代码位于 js/cache.js ，我们为了防止它弹出选择注掉这部分内容，删掉也可以，函数名称为 showNotice()</p>
</blockquote>
<ul>
<li>cache.js</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">//公告层
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">showNotice</span>() {
  <span style="color:#75715e">// 这是layuicms作者添加的模板公告内容，咱们把它注掉
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// layer.open({
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//     type: 1,
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//     title: &#34;系统公告&#34;,
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//     area: &#39;300px&#39;,
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//     shade: 0.8,
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//     id: &#39;LAY_layuipro&#39;,
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//     btn: [&#39;火速围观&#39;],
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//     moveType: 1,
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//     content: &#39;&lt;div style=&#34;padding:15px 20px; text-align:justify; line-height: 22px; text-indent:2em;border-bottom:1px solid #e2e2e2;&#34;&gt;&lt;p class=&#34;layui-red&#34;&gt;请使用模版前请务必仔细阅读首页右下角的《更新日志》，避免使用中遇到一些简单的问题造成困扰。&lt;/p&gt;&lt;/pclass&gt;&lt;/p&gt;&lt;p&gt;1.0发布以后发现很多朋友将代码上传到各种素材网站，当然这样帮我宣传我谢谢大家，但是有部分朋友上传到素材网站后将下载分值设置的相对较高，需要朋友们充钱才能下载。本人发现后通过和站长、网站管理员联系以后将分值调整为不需要充值才能下载或者直接免费下载。在此郑重提示各位：&lt;span class=&#34;layui-red&#34;&gt;本模版已进行作品版权证明，不管以何种形式获取的源码，请勿进行出售或者上传到任何素材网站，否则将追究相应的责任。&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&#39;,
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//     success: function(layero){
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//         var btn = layero.find(&#39;.layui-layer-btn&#39;);
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//         btn.css(&#39;text-align&#39;, &#39;center&#39;);
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//         btn.on(&#34;click&#34;,function(){
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//             tipsShow();
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//         });
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//     },
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//     cancel: function(index, layero){
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//         tipsShow();
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//     }
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// });
</span><span style="color:#75715e"></span>}
</code></pre></div><p>今后为了方便我将 layui 版本升级后的 layuicms2.0 单独保存以便重复使用。</p>
<hr>
<h3 id="12-查看页面是否导入成功">1.2. 查看页面是否导入成功</h3>
<blockquote>
<p>小知识：Spring Boot 项目初始化的 <strong>resources/static</strong> 文件夹可以自由访问无需添加 controller 层配置路径，所以在搭建项目修改页面的初期，建议将全部内容都放在 static 文件夹下，浏览器访问路径就是 static 下的文件路径(不包含<del>static</del>)，这样可以第一时间查看页面修改的样式</p>
</blockquote>
<p>登录页面：</p>
<!-- raw HTML omitted -->
<p>登录页面的背景图片可以换，目录是 <strong>images/login_bg.jpg</strong></p>
<p>系统主页：</p>
<!-- raw HTML omitted -->
<hr>
<h3 id="13-删除-index-不需要的内容">1.3. 删除 index 不需要的内容</h3>
<p>首先删除左上角的下拉框中无用的功能，只保留个人资料修改密码和退出</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>修改上方菜单</p>
<blockquote>
<p>layuicms2.0 中上方菜单对应着左侧的菜单栏，点选上方菜单将会切换左侧菜单栏，我们需要首先修改 json/navs.json，这里是菜单内容的数据来源，删除层次只保留一个 json 菜单串，然后再修改 js/index.js 中的内容，不需要再判断，最后删除 index 页面上方菜单的标签</p>
</blockquote>
<p>navs.json：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#960050;background-color:#1e0010">//</span> {
<span style="color:#960050;background-color:#1e0010">//</span>   <span style="color:#f92672">&#34;contentManagement&#34;</span>:
[
  {
    <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;文章列表&#34;</span>,
    <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;icon-text&#34;</span>,
    <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/news/newsList.html&#34;</span>,
    <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>
  },
  {
    <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;图片管理&#34;</span>,
    <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;&amp;#xe634;&#34;</span>,
    <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/img/images.html&#34;</span>,
    <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>
  },
  {
    <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;其他页面&#34;</span>,
    <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;&amp;#xe630;&#34;</span>,
    <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>,
    <span style="color:#f92672">&#34;children&#34;</span>: [
      {
        <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;404页面&#34;</span>,
        <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;&amp;#xe61c;&#34;</span>,
        <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/404.html&#34;</span>,
        <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>
      },
      {
        <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;登录&#34;</span>,
        <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;&amp;#xe609;&#34;</span>,
        <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/login/login.html&#34;</span>,
        <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>,
        <span style="color:#f92672">&#34;target&#34;</span>: <span style="color:#e6db74">&#34;_blank&#34;</span>
      }
    ]
  }
]
<span style="color:#960050;background-color:#1e0010">//</span>   ,
<span style="color:#960050;background-color:#1e0010">//</span>   <span style="color:#f92672">&#34;memberCenter&#34;</span>: [
<span style="color:#960050;background-color:#1e0010">//</span>     {
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;用户中心&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;&amp;#xe612;&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/user/userList.html&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>
<span style="color:#960050;background-color:#1e0010">//</span>     },
<span style="color:#960050;background-color:#1e0010">//</span>     {
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;会员等级&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;icon-vip&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/user/userGrade.html&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>
<span style="color:#960050;background-color:#1e0010">//</span>     }
<span style="color:#960050;background-color:#1e0010">//</span>   ],
<span style="color:#960050;background-color:#1e0010">//</span>   <span style="color:#f92672">&#34;systemeSttings&#34;</span>: [
<span style="color:#960050;background-color:#1e0010">//</span>     {
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;系统基本参数&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;&amp;#xe631;&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/systemSetting/basicParameter.html&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>
<span style="color:#960050;background-color:#1e0010">//</span>     },
<span style="color:#960050;background-color:#1e0010">//</span>     {
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;系统日志&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;icon-log&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/systemSetting/logs.html&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>
<span style="color:#960050;background-color:#1e0010">//</span>     },
<span style="color:#960050;background-color:#1e0010">//</span>     {
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;友情链接&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;&amp;#xe64c;&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/systemSetting/linkList.html&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>
<span style="color:#960050;background-color:#1e0010">//</span>     },
<span style="color:#960050;background-color:#1e0010">//</span>     {
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;图标管理&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;&amp;#xe857;&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/systemSetting/icons.html&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>
<span style="color:#960050;background-color:#1e0010">//</span>     }
<span style="color:#960050;background-color:#1e0010">//</span>   ],
<span style="color:#960050;background-color:#1e0010">//</span>   <span style="color:#f92672">&#34;seraphApi&#34;</span>: [
<span style="color:#960050;background-color:#1e0010">//</span>     {
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;三级联动模块&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;icon-mokuai&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/doc/addressDoc.html&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>
<span style="color:#960050;background-color:#1e0010">//</span>     },
<span style="color:#960050;background-color:#1e0010">//</span>     {
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;bodyTab模块&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;icon-mokuai&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/doc/bodyTabDoc.html&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>
<span style="color:#960050;background-color:#1e0010">//</span>     },
<span style="color:#960050;background-color:#1e0010">//</span>     {
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;三级菜单&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;icon-mokuai&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/doc/navDoc.html&#34;</span>,
<span style="color:#960050;background-color:#1e0010">//</span>       <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>
<span style="color:#960050;background-color:#1e0010">//</span>     }
<span style="color:#960050;background-color:#1e0010">//</span>   ]
<span style="color:#960050;background-color:#1e0010">//</span> }
</code></pre></div><p>index.js：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getData</span>(<span style="color:#a6e22e">json</span>) {
  <span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">getJSON</span>(<span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">tabConfig</span>.<span style="color:#a6e22e">url</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>) {
    <span style="color:#75715e">// if (json == &#34;contentManagement&#34;) {
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">dataStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">contentManagement</span>;
    <span style="color:#75715e">//重新渲染左侧菜单
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">render</span>();
    <span style="color:#75715e">// } else if (json == &#34;memberCenter&#34;) {
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//   dataStr = data.memberCenter;
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//   //重新渲染左侧菜单
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//   tab.render();
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// } else if (json == &#34;systemeSttings&#34;) {
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//   dataStr = data.systemeSttings;
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//   //重新渲染左侧菜单
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//   tab.render();
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// } else if (json == &#34;seraphApi&#34;) {
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//   dataStr = data.seraphApi;
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//   //重新渲染左侧菜单
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//   tab.render();
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// }
</span><span style="color:#75715e"></span>  });
}
</code></pre></div><hr>
<h3 id="14-修改工作台-pagemainhtml">1.4. 修改工作台 page/main.html</h3>
<p>只保留最新消息的表格，其余全部删除</p>
<ul>
<li>删除后：</li>
</ul>
<!-- raw HTML omitted -->
<hr>
<h2 id="2-搭建-spring-boot-项目">2. 搭建 Spring Boot 项目</h2>
<h3 id="21-引入依赖">2.1. 引入依赖</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>com.baomidou<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>mybatis-plus-boot-starter<span style="color:#f92672">&lt;/artifactId&gt;</span>
            <span style="color:#f92672">&lt;version&gt;</span>3.3.1<span style="color:#f92672">&lt;/version&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>

        <span style="color:#75715e">&lt;!-- commons-lang3工具包 --&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.commons<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>commons-lang3<span style="color:#f92672">&lt;/artifactId&gt;</span>
            <span style="color:#f92672">&lt;version&gt;</span>3.9<span style="color:#f92672">&lt;/version&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>

        <span style="color:#75715e">&lt;!-- 集成阿里巴巴fastjson --&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>com.alibaba<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>fastjson<span style="color:#f92672">&lt;/artifactId&gt;</span>
            <span style="color:#f92672">&lt;version&gt;</span>1.2.60<span style="color:#f92672">&lt;/version&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>

        <span style="color:#75715e">&lt;!-- spring整合shiro --&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.shiro<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>shiro-spring<span style="color:#f92672">&lt;/artifactId&gt;</span>
            <span style="color:#f92672">&lt;version&gt;</span>1.4.2<span style="color:#f92672">&lt;/version&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>
        <span style="color:#75715e">&lt;!-- thymeleaf对shiro的支持 --&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>com.github.theborakompanioni<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>thymeleaf-extras-shiro<span style="color:#f92672">&lt;/artifactId&gt;</span>
            <span style="color:#f92672">&lt;version&gt;</span>2.0.0<span style="color:#f92672">&lt;/version&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>

        <span style="color:#75715e">&lt;!-- log4j --&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>log4j<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>log4j<span style="color:#f92672">&lt;/artifactId&gt;</span>
            <span style="color:#f92672">&lt;version&gt;</span>1.2.17<span style="color:#f92672">&lt;/version&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>

        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-aop<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>

        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-devtools<span style="color:#f92672">&lt;/artifactId&gt;</span>
            <span style="color:#f92672">&lt;scope&gt;</span>runtime<span style="color:#f92672">&lt;/scope&gt;</span>
            <span style="color:#f92672">&lt;optional&gt;</span>true<span style="color:#f92672">&lt;/optional&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>
        <span style="color:#75715e">&lt;!-- druid-spring-boot-starter阿里数据库连接池 --&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>com.alibaba<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>druid-spring-boot-starter<span style="color:#f92672">&lt;/artifactId&gt;</span>
            <span style="color:#f92672">&lt;version&gt;</span>1.1.21<span style="color:#f92672">&lt;/version&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>mysql<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>mysql-connector-java<span style="color:#f92672">&lt;/artifactId&gt;</span>
            <span style="color:#f92672">&lt;scope&gt;</span>runtime<span style="color:#f92672">&lt;/scope&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>org.projectlombok<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>lombok<span style="color:#f92672">&lt;/artifactId&gt;</span>
            <span style="color:#f92672">&lt;optional&gt;</span>true<span style="color:#f92672">&lt;/optional&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-boot-starter-test<span style="color:#f92672">&lt;/artifactId&gt;</span>
            <span style="color:#f92672">&lt;scope&gt;</span>test<span style="color:#f92672">&lt;/scope&gt;</span>
            <span style="color:#f92672">&lt;exclusions&gt;</span>
                <span style="color:#f92672">&lt;exclusion&gt;</span>
                    <span style="color:#f92672">&lt;groupId&gt;</span>org.junit.vintage<span style="color:#f92672">&lt;/groupId&gt;</span>
                    <span style="color:#f92672">&lt;artifactId&gt;</span>junit-vintage-engine<span style="color:#f92672">&lt;/artifactId&gt;</span>
                <span style="color:#f92672">&lt;/exclusion&gt;</span>
            <span style="color:#f92672">&lt;/exclusions&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><hr>
<h3 id="22-yaml-配置">2.2. yaml 配置</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">server</span>:
  <span style="color:#66d9ef">port</span>: <span style="color:#ae81ff">9000</span>
<span style="color:#66d9ef">spring</span>:
  <span style="color:#66d9ef">application</span>:
    <span style="color:#66d9ef">name</span>: warehouse
  <span style="color:#66d9ef">datasource</span>:
    <span style="color:#75715e"># 连接池相关配置</span>
    <span style="color:#66d9ef">druid</span>:
      <span style="color:#66d9ef">driver-class-name</span>: com.mysql.cj.jdbc.Driver
      <span style="color:#66d9ef">url</span>: jdbc:mysql://localhost:<span style="color:#ae81ff">3306</span>/shining?useSSL=<span style="color:#66d9ef">false</span><span style="color:#75715e">&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT%2B8</span>
      <span style="color:#66d9ef">username</span>: root
      <span style="color:#66d9ef">password</span>: YLM19980514i
      <span style="color:#66d9ef">max-active</span>: <span style="color:#ae81ff">20</span>
      <span style="color:#66d9ef">max-wait</span>: <span style="color:#ae81ff">5000</span>
      <span style="color:#66d9ef">initial-size</span>: <span style="color:#ae81ff">1</span>
      <span style="color:#66d9ef">filters</span>: log4j,stat,wall
      <span style="color:#66d9ef">validation-query</span>: SELECT <span style="color:#e6db74">&#39;x&#39;</span> <span style="color:#75715e"># 验证连接</span>
      <span style="color:#66d9ef">enable</span>: <span style="color:#66d9ef">true</span>
      <span style="color:#75715e"># 监控配置</span>
      <span style="color:#66d9ef">stat-view-servlet</span>:
        <span style="color:#66d9ef">enabled</span>: <span style="color:#66d9ef">true</span>
        <span style="color:#66d9ef">login-username</span>: root
        <span style="color:#66d9ef">login-password</span>: root
        <span style="color:#66d9ef">url-pattern</span>: /druid/*
  <span style="color:#75715e"># json处理配置</span>
  <span style="color:#66d9ef">jackson</span>:
    <span style="color:#66d9ef">date-format</span>: yyyy-MM-dd HH:mm:ss
    <span style="color:#66d9ef">time-zone</span>: GMT<span style="color:#ae81ff">+8</span>

  <span style="color:#75715e"># 配置thymeleaf</span>
  <span style="color:#66d9ef">thymeleaf</span>:
    <span style="color:#66d9ef">cache</span>: <span style="color:#66d9ef">false</span>
    <span style="color:#66d9ef">enabled</span>: <span style="color:#66d9ef">true</span>
  <span style="color:#75715e"># 配置devtools</span>
  <span style="color:#66d9ef">devtools</span>:
    <span style="color:#66d9ef">restart</span>:
      <span style="color:#66d9ef">enabled</span>: <span style="color:#66d9ef">true</span>
      <span style="color:#66d9ef">additional-paths</span>:
        - src/main/java
        - src/main/resources
<span style="color:#75715e"># 开启Mybatis的驼峰命名法</span>
<span style="color:#66d9ef">mybatis-plus</span>:
  <span style="color:#66d9ef">mapper-locations</span>:
    - classpath:mapper/<span style="color:#75715e">*/*Mapper.xml</span>
  <span style="color:#66d9ef">global-config</span>:
    <span style="color:#66d9ef">db-config</span>:
      <span style="color:#66d9ef">id-type</span>: auto
    <span style="color:#66d9ef">banner</span>: <span style="color:#66d9ef">true</span>
  <span style="color:#66d9ef">configuration</span>:
    <span style="color:#66d9ef">map-underscore-to-camel-case</span>: <span style="color:#66d9ef">true</span>
</code></pre></div><hr>
<h3 id="23-实现登录功能">2.3. 实现登录功能</h3>
<h4 id="231-代码生成">2.3.1. 代码生成</h4>
<p>利用 mybatis-plus 提供的代码生成器生成数据库 user 表的代码，包括 entity、mapper、service、controller。</p>
<!-- raw HTML omitted -->
<p>在启动类上添加<code>@mapperscan</code>注解</p>
<h4 id="232-创建-activeuser-类">2.3.2. 创建 ActiveUser 类</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.warehouse.sys.common<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.warehouse.sys.entity.User<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.AllArgsConstructor<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.Builder<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.Data<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.NoArgsConstructor<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.util.List<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * @program: mybaitis-plus-generator
</span><span style="color:#75715e"> * @description: 登录的用户
</span><span style="color:#75715e"> * @author: Dawn
</span><span style="color:#75715e"> * @create: 2020-02-24 18:58
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Data</span>
<span style="color:#a6e22e">@Builder</span>
<span style="color:#a6e22e">@AllArgsConstructor</span>
<span style="color:#a6e22e">@NoArgsConstructor</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ActiveUser</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">// 登录用户
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> User user<span style="color:#f92672">;</span>

    <span style="color:#75715e">// 角色
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> roles<span style="color:#f92672">;</span>

    <span style="color:#75715e">// 权限
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> permissions<span style="color:#f92672">;</span>

<span style="color:#f92672">}</span>

</code></pre></div><h4 id="233-创建-userrealm">2.3.3. 创建 UserRealm</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.warehouse.sys.config.realm<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.common.entity.ActiveUser<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.entity.User<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.service.IUserService<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.authc.AuthenticationException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.authc.AuthenticationInfo<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.authc.AuthenticationToken<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.authz.AuthorizationInfo<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.realm.AuthorizingRealm<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.subject.PrincipalCollection<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.util.ByteSource<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Autowired<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * @program: mybaitis-plus-generator
</span><span style="color:#75715e"> * @description: userRealm
</span><span style="color:#75715e"> * @author: Dawn
</span><span style="color:#75715e"> * @create: 2020-02-24 19:01
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserRealm</span> <span style="color:#66d9ef">extends</span> AuthorizingRealm <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Autowired</span>
    <span style="color:#66d9ef">private</span> IUserService userService<span style="color:#f92672">;</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 返回类名以供判断
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getSimpleName</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 授权方法
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> AuthorizationInfo <span style="color:#a6e22e">doGetAuthorizationInfo</span><span style="color:#f92672">(</span>PrincipalCollection principalCollection<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 认证方法
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> AuthenticationInfo <span style="color:#a6e22e">doGetAuthenticationInfo</span><span style="color:#f92672">(</span>AuthenticationToken authenticationToken<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> AuthenticationException <span style="color:#f92672">{</span>

        QueryWrapper<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> queryWrapper <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> QueryWrapper<span style="color:#f92672">&lt;&gt;();</span>
        queryWrapper<span style="color:#f92672">.</span><span style="color:#a6e22e">eq</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;loginname&#34;</span><span style="color:#f92672">,</span>authenticationToken<span style="color:#f92672">.</span><span style="color:#a6e22e">getPrincipal</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>

        User user <span style="color:#f92672">=</span> userService<span style="color:#f92672">.</span><span style="color:#a6e22e">getOne</span><span style="color:#f92672">(</span>queryWrapper<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">!=</span>user<span style="color:#f92672">){</span>
            <span style="color:#75715e">// 填充一个ActiveUser
</span><span style="color:#75715e"></span>            ActiveUser activeUser <span style="color:#f92672">=</span> ActiveUser<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">user</span><span style="color:#f92672">(</span>user<span style="color:#f92672">)</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
            <span style="color:#75715e">// 取出该user的盐值
</span><span style="color:#75715e"></span>            ByteSource bytesSalt <span style="color:#f92672">=</span> ByteSource<span style="color:#f92672">.</span><span style="color:#a6e22e">Util</span><span style="color:#f92672">.</span><span style="color:#a6e22e">bytes</span><span style="color:#f92672">(</span>user<span style="color:#f92672">.</span><span style="color:#a6e22e">getSalt</span><span style="color:#f92672">());</span>

            <span style="color:#75715e">// 返回
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> SimpleAuthenticationInfo<span style="color:#f92672">(</span>activeUser<span style="color:#f92672">,</span>
                    user<span style="color:#f92672">.</span><span style="color:#a6e22e">getPwd</span><span style="color:#f92672">(),</span>
                    bytesSalt<span style="color:#f92672">,</span>
                    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="234-配置-shiro">2.3.4. 配置 shiro</h4>
<p>创建<code>ShiroConfig</code>类</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
<span style="color:#f92672">package</span> com.warehouse.sys.config<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> at.pollux.thymeleaf.shiro.dialect.ShiroDialect<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.config.realm.UserRealm<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.Data<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.authc.credential.CredentialsMatcher<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.authc.credential.HashedCredentialsMatcher<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.mgt.SecurityManager<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.spring.web.ShiroFilterFactoryBean<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.web.mgt.DefaultWebSecurityManager<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnClass<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication.Type<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.boot.context.properties.ConfigurationProperties<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.boot.web.servlet.FilterRegistrationBean<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.context.annotation.Bean<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.context.annotation.Configuration<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.filter.DelegatingFilterProxy<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.util.HashMap<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.Map<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.Filter<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * @program: mybaitis-plus-generator
</span><span style="color:#75715e"> * @description: shiro配置类
</span><span style="color:#75715e"> * @author: Dawn
</span><span style="color:#75715e"> * @create: 2020-02-24 19:14
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Configuration</span>
<span style="color:#a6e22e">@ConditionalOnWebApplication</span><span style="color:#f92672">(</span>type <span style="color:#f92672">=</span> Type<span style="color:#f92672">.</span><span style="color:#a6e22e">SERVLET</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@ConditionalOnClass</span><span style="color:#f92672">(</span>value <span style="color:#f92672">=</span> <span style="color:#f92672">{</span> SecurityManager<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span> <span style="color:#f92672">})</span>
<span style="color:#a6e22e">@ConfigurationProperties</span><span style="color:#f92672">(</span>prefix <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;shiro&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@Data</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ShiroConfig</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String SHIRO_DIALECT <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;shiroDialect&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String SHIRO_FILTER <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;shiroFilter&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String hashAlgorithmName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;md5&#34;</span><span style="color:#f92672">;</span><span style="color:#75715e">// 加密方式
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> hashIterations <span style="color:#f92672">=</span> 2<span style="color:#f92672">;</span><span style="color:#75715e">// 散列次数
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> String loginUrl <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/index.html&#34;</span><span style="color:#f92672">;</span><span style="color:#75715e">// 默认的登陆页面
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">private</span> String<span style="color:#f92672">[]</span> anonUrls<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String logOutUrl<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String<span style="color:#f92672">[]</span> authcUlrs<span style="color:#f92672">;</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 声明凭证匹配器
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Bean</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;credentialsMatcher&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> HashedCredentialsMatcher <span style="color:#a6e22e">hashedCredentialsMatcher</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        HashedCredentialsMatcher credentialsMatcher <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashedCredentialsMatcher<span style="color:#f92672">();</span>
        credentialsMatcher<span style="color:#f92672">.</span><span style="color:#a6e22e">setHashAlgorithmName</span><span style="color:#f92672">(</span>hashAlgorithmName<span style="color:#f92672">);</span>
        credentialsMatcher<span style="color:#f92672">.</span><span style="color:#a6e22e">setHashIterations</span><span style="color:#f92672">(</span>hashIterations<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> credentialsMatcher<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 声明userRealm
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Bean</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;userRealm&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> UserRealm <span style="color:#a6e22e">userRealm</span><span style="color:#f92672">(</span>CredentialsMatcher credentialsMatcher<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        UserRealm userRealm <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UserRealm<span style="color:#f92672">();</span>
        <span style="color:#75715e">// 注入凭证匹配器
</span><span style="color:#75715e"></span>        userRealm<span style="color:#f92672">.</span><span style="color:#a6e22e">setCredentialsMatcher</span><span style="color:#f92672">(</span>credentialsMatcher<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> userRealm<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 配置SecurityManager
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Bean</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;securityManager&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> SecurityManager <span style="color:#a6e22e">securityManager</span><span style="color:#f92672">(</span>UserRealm userRealm<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        DefaultWebSecurityManager securityManager <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DefaultWebSecurityManager<span style="color:#f92672">();</span>
        <span style="color:#75715e">// 注入userRealm
</span><span style="color:#75715e"></span>        securityManager<span style="color:#f92672">.</span><span style="color:#a6e22e">setRealm</span><span style="color:#f92672">(</span>userRealm<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> securityManager<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 配置shiro的过滤器
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Bean</span><span style="color:#f92672">(</span>SHIRO_FILTER<span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> ShiroFilterFactoryBean <span style="color:#a6e22e">shiroFilterFactoryBean</span><span style="color:#f92672">(</span>SecurityManager securityManager<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        ShiroFilterFactoryBean factoryBean <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ShiroFilterFactoryBean<span style="color:#f92672">();</span>
        <span style="color:#75715e">// 设置安全管理器
</span><span style="color:#75715e"></span>        factoryBean<span style="color:#f92672">.</span><span style="color:#a6e22e">setSecurityManager</span><span style="color:#f92672">(</span>securityManager<span style="color:#f92672">);</span>
        <span style="color:#75715e">// 设置未登陆的时要跳转的页面
</span><span style="color:#75715e"></span>        factoryBean<span style="color:#f92672">.</span><span style="color:#a6e22e">setLoginUrl</span><span style="color:#f92672">(</span>loginUrl<span style="color:#f92672">);</span>
        Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;</span> filterChainDefinitionMap <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
        <span style="color:#75715e">// 设置放行的路径
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>anonUrls <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> anonUrls<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String anon <span style="color:#f92672">:</span> anonUrls<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                filterChainDefinitionMap<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>anon<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;anon&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">// 设置登出的路径
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">null</span> <span style="color:#f92672">!=</span> logOutUrl<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            filterChainDefinitionMap<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>logOutUrl<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;logout&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">// 设置拦截的路径
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>authcUlrs <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> authcUlrs<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String authc <span style="color:#f92672">:</span> authcUlrs<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                filterChainDefinitionMap<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>authc<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;authc&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Filter<span style="color:#f92672">&gt;</span> filters<span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
<span style="color:#75715e">//		filters.put(&#34;authc&#34;, new ShiroLoginFilter());
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//配置过滤器
</span><span style="color:#75715e"></span>        factoryBean<span style="color:#f92672">.</span><span style="color:#a6e22e">setFilters</span><span style="color:#f92672">(</span>filters<span style="color:#f92672">);</span>
        factoryBean<span style="color:#f92672">.</span><span style="color:#a6e22e">setFilterChainDefinitionMap</span><span style="color:#f92672">(</span>filterChainDefinitionMap<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> factoryBean<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 注册shiro的委托过滤器，相当于之前在web.xml里面配置的
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * @return
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#66d9ef">public</span> FilterRegistrationBean<span style="color:#f92672">&lt;</span>DelegatingFilterProxy<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">delegatingFilterProxy</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        FilterRegistrationBean<span style="color:#f92672">&lt;</span>DelegatingFilterProxy<span style="color:#f92672">&gt;</span> filterRegistrationBean <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FilterRegistrationBean<span style="color:#f92672">&lt;</span>DelegatingFilterProxy<span style="color:#f92672">&gt;();</span>
        DelegatingFilterProxy proxy <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DelegatingFilterProxy<span style="color:#f92672">();</span>
        proxy<span style="color:#f92672">.</span><span style="color:#a6e22e">setTargetFilterLifecycle</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
        proxy<span style="color:#f92672">.</span><span style="color:#a6e22e">setTargetBeanName</span><span style="color:#f92672">(</span>SHIRO_FILTER<span style="color:#f92672">);</span>
        filterRegistrationBean<span style="color:#f92672">.</span><span style="color:#a6e22e">setFilter</span><span style="color:#f92672">(</span>proxy<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> filterRegistrationBean<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/* 加入注解的使用，不加入这个注解不生效--开始 */</span>
    <span style="color:#75715e">/**
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * @param securityManager
</span><span style="color:#75715e">     * @return
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#66d9ef">public</span> AuthorizationAttributeSourceAdvisor <span style="color:#a6e22e">authorizationAttributeSourceAdvisor</span><span style="color:#f92672">(</span>SecurityManager securityManager<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> AuthorizationAttributeSourceAdvisor<span style="color:#f92672">();</span>
        authorizationAttributeSourceAdvisor<span style="color:#f92672">.</span><span style="color:#a6e22e">setSecurityManager</span><span style="color:#f92672">(</span>securityManager<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> authorizationAttributeSourceAdvisor<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#66d9ef">public</span> DefaultAdvisorAutoProxyCreator <span style="color:#a6e22e">getDefaultAdvisorAutoProxyCreator</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        DefaultAdvisorAutoProxyCreator advisorAutoProxyCreator <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DefaultAdvisorAutoProxyCreator<span style="color:#f92672">();</span>
        advisorAutoProxyCreator<span style="color:#f92672">.</span><span style="color:#a6e22e">setProxyTargetClass</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> advisorAutoProxyCreator<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">/* 加入注解的使用，不加入这个注解不生效--结束 */</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 这里是为了能在html页面引用shiro标签，上面两个函数必须添加，不然会报错
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     * @return
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Bean</span><span style="color:#f92672">(</span>name <span style="color:#f92672">=</span> SHIRO_DIALECT<span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> ShiroDialect <span style="color:#a6e22e">shiroDialect</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> ShiroDialect<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>在 yaml 中添加 shiro 的配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e">#shiro的配置</span>
<span style="color:#66d9ef">shiro</span>:
  <span style="color:#66d9ef">hash-algorithm-name</span>: md5
  <span style="color:#66d9ef">hash-iterations</span>: <span style="color:#ae81ff">2</span>
  <span style="color:#66d9ef">anon-urls</span>:
    - /index.html*
    - /sys/toLogin*
    - /login/login*
    - /resources/<span style="color:#75715e">**</span>
  <span style="color:#66d9ef">login-url</span>: /index.html
  <span style="color:#66d9ef">log-out-url</span>: /login/logout*
  <span style="color:#66d9ef">authc-ulrs</span>:
    - /<span style="color:#75715e">**</span>
</code></pre></div><h4 id="235-编写-logincontroller">2.3.5. 编写 LoginController</h4>
<p><code>LoginController</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.warehouse.sys.controller<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.warehouse.sys.common.utils.WebUtils<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.common.entity.ActiveUser<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.common.entity.ResultObj<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.SecurityUtils<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.authc.AuthenticationException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.authc.AuthenticationToken<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.authc.UsernamePasswordToken<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.apache.shiro.subject.Subject<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.PostMapping<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RequestMapping<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RestController<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.servlet.http.HttpSession<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * &lt;p&gt;
</span><span style="color:#75715e"> * 前端控制器
</span><span style="color:#75715e"> * &lt;/p&gt;
</span><span style="color:#75715e"> *
</span><span style="color:#75715e"> * @author Dawn
</span><span style="color:#75715e"> * @since 2020-02-24
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@RestController</span>
<span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LoginController</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@PostMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> ResultObj <span style="color:#a6e22e">login</span><span style="color:#f92672">(</span>String loginname<span style="color:#f92672">,</span> String pwd<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

        Subject subject <span style="color:#f92672">=</span> SecurityUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getSubject</span><span style="color:#f92672">();</span>
        AuthenticationToken usernamePasswordToken <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UsernamePasswordToken<span style="color:#f92672">(</span>loginname<span style="color:#f92672">,</span> pwd<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// shiro登录
</span><span style="color:#75715e"></span>            subject<span style="color:#f92672">.</span><span style="color:#a6e22e">login</span><span style="color:#f92672">(</span>usernamePasswordToken<span style="color:#f92672">);</span>
            <span style="color:#75715e">// 获取登录的账户
</span><span style="color:#75715e"></span>            ActiveUser activeUser <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>ActiveUser<span style="color:#f92672">)</span> subject<span style="color:#f92672">.</span><span style="color:#a6e22e">getPrincipal</span><span style="color:#f92672">();</span>
            <span style="color:#75715e">// 自建工具类获取session
</span><span style="color:#75715e"></span>            HttpSession session <span style="color:#f92672">=</span> WebUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">();</span>
            <span style="color:#75715e">// 添加登录信息到session中
</span><span style="color:#75715e"></span>            session<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">,</span> activeUser<span style="color:#f92672">);</span>

            <span style="color:#75715e">// 自定义的返回数据格式
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">return</span> ResultObj<span style="color:#f92672">.</span><span style="color:#a6e22e">LOGIN_SUCCESS</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>AuthenticationException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">return</span> ResultObj<span style="color:#f92672">.</span><span style="color:#a6e22e">LOGIN_ERROR</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p><code>ResultObj</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.warehouse.sys.common.entity<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.warehouse.sys.common.constants.WebConstants<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.AllArgsConstructor<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.Data<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.NoArgsConstructor<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * @program: mybaitis-plus-generator
</span><span style="color:#75715e"> * @description:
</span><span style="color:#75715e"> * @author: Dawn
</span><span style="color:#75715e"> * @create: 2020-02-25 16:59
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Data</span>
<span style="color:#a6e22e">@AllArgsConstructor</span>
<span style="color:#a6e22e">@NoArgsConstructor</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ResultObj</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> ResultObj LOGIN_SUCCESS<span style="color:#f92672">=</span>
            <span style="color:#66d9ef">new</span> ResultObj<span style="color:#f92672">(</span>WebConstants<span style="color:#f92672">.</span><span style="color:#a6e22e">OK</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;登录成功！&#34;</span><span style="color:#f92672">);</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> ResultObj LOGIN_ERROR<span style="color:#f92672">=</span>
            <span style="color:#66d9ef">new</span> ResultObj<span style="color:#f92672">(</span>WebConstants<span style="color:#f92672">.</span><span style="color:#a6e22e">ERROR</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;登录失败！请检查用户名和密码！&#34;</span><span style="color:#f92672">);</span>

    <span style="color:#66d9ef">private</span> Integer code<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String msg<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

</code></pre></div><p><code>WebConstants</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.warehouse.sys.common.constants<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * @program: mybaitis-plus-generator
</span><span style="color:#75715e"> * @description: 一些web层面的常量
</span><span style="color:#75715e"> * @author: Dawn
</span><span style="color:#75715e"> * @create: 2020-02-24 19:31
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">WebConstants</span> <span style="color:#f92672">{</span>
    Integer OK <span style="color:#f92672">=</span> 200<span style="color:#f92672">;</span>
    Integer ERROR <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><code>WebUtils</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
<span style="color:#f92672">package</span> com.warehouse.sys.common.utils<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> org.springframework.web.context.request.RequestContextHolder<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.context.request.ServletRequestAttributes<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.servlet.http.HttpServletRequest<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpSession<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * @program: mybaitis-plus-generator
</span><span style="color:#75715e"> * @description: web工具类
</span><span style="color:#75715e"> * @author: Dawn
</span><span style="color:#75715e"> * @create: 2020-02-25 17:09
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WebUtils</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 获取request
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> HttpServletRequest <span style="color:#a6e22e">getRequest</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        ServletRequestAttributes requestAttributes <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>ServletRequestAttributes<span style="color:#f92672">)</span> RequestContextHolder<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestAttributes</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">return</span> requestAttributes<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequest</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 获取session
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> HttpSession <span style="color:#a6e22e">getSession</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> getRequest<span style="color:#f92672">().</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="236-修改前台页面代码">2.3.6. 修改前台页面代码</h4>
<p><code>page/login/login.js</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">//登录按钮
</span><span style="color:#75715e"></span><span style="color:#a6e22e">form</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#34;submit(login)&#34;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>) {
  <span style="color:#75715e">// $(this)
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//   .text(&#34;登录中...&#34;)
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//   .attr(&#34;disabled&#34;, &#34;disabled&#34;)
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//   .addClass(&#34;layui-disabled&#34;);
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// setTimeout(function() {
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//   window.location.href = &#34;/layuicms2.0&#34;;
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// }, 1000);
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// return false;
</span><span style="color:#75715e"></span>
  <span style="color:#75715e">// layer.msg(data.field);
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">btn</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$</span>(<span style="color:#66d9ef">this</span>);
  <span style="color:#75715e">// 设置登录按钮为不可点击
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">btn</span>
    .<span style="color:#a6e22e">text</span>(<span style="color:#e6db74">&#34;登录中...&#34;</span>)
    .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#34;disable&#34;</span>, <span style="color:#e6db74">&#34;disable&#34;</span>)
    .<span style="color:#a6e22e">addClass</span>(<span style="color:#e6db74">&#34;layui-disabled&#34;</span>);
  <span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#34;/login/login&#34;</span>, <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">field</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">result</span>) {
    <span style="color:#a6e22e">btn</span>
      .<span style="color:#a6e22e">text</span>(<span style="color:#e6db74">&#34;登录&#34;</span>)
      .<span style="color:#a6e22e">attr</span>(<span style="color:#e6db74">&#34;disable&#34;</span>, <span style="color:#66d9ef">false</span>)
      .<span style="color:#a6e22e">removeClass</span>(<span style="color:#e6db74">&#34;layui-disabled&#34;</span>);

    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">code</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>) {
      <span style="color:#75715e">// 跳转到主页
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">layer</span>.<span style="color:#a6e22e">msg</span>(<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">msg</span>);
      <span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">href</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/sys/index&#34;</span>;
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#a6e22e">layer</span>.<span style="color:#a6e22e">msg</span>(<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">msg</span>);
    }
  });
  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
});
</code></pre></div><p>为 login.html 的表单添加与后台函数对应的 name 属性</p>
<blockquote>
<p>启动项目测试登录时发现样式全无，检查后发现，雷哥的项目把静态资源全部放在 static 的自建 resources 目录下，配置 shiro 的时候只需添加静态目录<code>/resources/**</code>即可过滤，而我的静态资源是直接放在 static 文件夹中的，需要<strong>为 shiro 手动添加所有的静态资源目录，也可以像雷哥一样放在一个公共目录下</strong></p>
</blockquote>
<p>添加之后的 yaml 的 shiro 配置如下:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e">#shiro的配置</span>
<span style="color:#66d9ef">shiro</span>:
  <span style="color:#66d9ef">hash-algorithm-name</span>: md5
  <span style="color:#66d9ef">hash-iterations</span>: <span style="color:#ae81ff">2</span>
  <span style="color:#66d9ef">anon-urls</span>:
    - /index.html*
    - /sys/toLogin*
    - /login/login*
    <span style="color:#75715e"># 静态资源不拦截</span>
    - /resources/<span style="color:#75715e">**</span>
  <span style="color:#66d9ef">login-url</span>: /index.html
  <span style="color:#66d9ef">log-out-url</span>: /login/logout*
  <span style="color:#66d9ef">authc-ulrs</span>:
    - /<span style="color:#75715e">**</span>
</code></pre></div><p>测试登录成功</p>
<blockquote>
<p>主页左侧的菜单树又出现故障，这里需要修改 resources/js/index.js，把里面的所有请求路径统一修改成包含<code>/resources/**</code>的样子，类似如下</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">layui</span>
  .<span style="color:#a6e22e">config</span>({
    <span style="color:#a6e22e">base</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/resources/js/&#34;</span>
  })
  .<span style="color:#a6e22e">extend</span>({
    <span style="color:#a6e22e">bodyTab</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;bodyTab&#34;</span>
  });
</code></pre></div><blockquote>
<p>shiro 检测到未登录会请求<code>/index.html</code>，我们在 static 目录里添加 index.html，设置成跳转到登录页面，代码如下</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
  &lt;<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> /&gt;
    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span> /&gt;
    &lt;<span style="color:#f92672">title</span>&gt;shiro跳转&lt;/<span style="color:#f92672">title</span>&gt;
  &lt;/<span style="color:#f92672">head</span>&gt;
  &lt;<span style="color:#f92672">body</span>&gt;
    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/javascript&#34;</span>&gt;
      window.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">href</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/sys/toLogin&#34;</span>;
    &lt;/<span style="color:#f92672">script</span>&gt;
  &lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><p>接下来修改前台页面中下面几处，让它显示成用户的信息</p>
<!-- raw HTML omitted -->
<p>在页面中使用模版引擎 thymeleaf ，首先要在页面上引入 thymeleaf 命名空间<code>&lt;html xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;</code><!-- raw HTML omitted -->
再按照<code>th:text=&quot;${session.user.name!=null}?${session.user.name}&quot;</code>的格式重写这几处标签</p>
<hr>
<h3 id="24-生成菜单">2.4. 生成菜单</h3>
<blockquote>
<p>layuicms2.0 的菜单是从 json 串中解析得到的，那么我们就要根据登录用户的身份取判断应当加载那些菜单，这里有几个步骤</p>
</blockquote>
<ol>
<li>根据登录用户的身份去后台查询他拥有的角色</li>
<li>根据角色查询权限</li>
<li>根据权限查询菜单</li>
<li>根据菜单构造 json 字符串返回给前台解析</li>
</ol>
<ul>
<li>json 串的构造</li>
</ul>
<table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">title</td>
<td align="left">菜单标题</td>
</tr>
<tr>
<td align="left">icon</td>
<td align="left">菜单图标</td>
</tr>
<tr>
<td align="left">href</td>
<td align="left">菜单链接</td>
</tr>
<tr>
<td align="left">spread</td>
<td align="left">是否展开 <em>true 或 false</em></td>
</tr>
<tr>
<td align="left">children</td>
<td align="left">菜单子节点 <em>内部又是一个菜单数据</em></td>
</tr>
</tbody>
</table>
<ul>
<li>示例：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">[
  {
    <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;其他页面&#34;</span>,
    <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;&amp;#xe630;&#34;</span>,
    <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>,
    <span style="color:#f92672">&#34;children&#34;</span>: [
      {
        <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;404页面&#34;</span>,
        <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;&amp;#xe61c;&#34;</span>,
        <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/404.html&#34;</span>,
        <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>
      },
      {
        <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;登录&#34;</span>,
        <span style="color:#f92672">&#34;icon&#34;</span>: <span style="color:#e6db74">&#34;&amp;#xe609;&#34;</span>,
        <span style="color:#f92672">&#34;href&#34;</span>: <span style="color:#e6db74">&#34;page/login/login.html&#34;</span>,
        <span style="color:#f92672">&#34;spread&#34;</span>: <span style="color:#66d9ef">false</span>,
        <span style="color:#f92672">&#34;target&#34;</span>: <span style="color:#e6db74">&#34;_blank&#34;</span>
      }
    ]
  }
]
</code></pre></div><h4 id="241-代码生成">2.4.1. 代码生成</h4>
<p>模块名：sys</p>
<p>表名：sys_permission</p>
<p>过程略，和上边一样的</p>
<h4 id="242-建立-datagridview-类">2.4.2. 建立 DataGridView 类</h4>
<p>这个类是后端向前端传递 json 数据的包装类，除了 json 数据外包含一些信息</p>
<p><code>DataGridView</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.warehouse.sys.common.entity<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> lombok.AllArgsConstructor<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.Data<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.NoArgsConstructor<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * @program: warehouse
</span><span style="color:#75715e"> * @description: json数据实体
</span><span style="color:#75715e"> * @author: Dawn
</span><span style="color:#75715e"> * @create: 2020-02-25 21:06
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Data</span>
<span style="color:#a6e22e">@AllArgsConstructor</span>
<span style="color:#a6e22e">@NoArgsConstructor</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DataGridView</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">// 执行是否成功的代码
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> Integer code<span style="color:#f92672">=</span>0<span style="color:#f92672">;</span>
    <span style="color:#75715e">// 传递的消息
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> String msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">// 数据的长度
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> Long count<span style="color:#f92672">=</span>0L<span style="color:#f92672">;</span>
    <span style="color:#75715e">// json数据
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> Object data<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">DataGridView</span><span style="color:#f92672">(</span>Long count<span style="color:#f92672">,</span> Object data<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">super</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">count</span> <span style="color:#f92672">=</span> count<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> data<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">DataGridView</span><span style="color:#f92672">(</span>Object data<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">super</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> data<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><h4 id="243-处理数据转换成-json">2.4.3. 处理数据转换成 json</h4>
<blockquote>
<p>数据库中的菜单数据所在的表 sys_permission 还存有权限数据，也就是说传递到前端的数据格式并不是 layuicms2.0 的标准 json 格式，还存在一些没有数据的空字段，我们需要在向前端返回数据之前将菜单数据处理成前端的标准格式</p>
</blockquote>
<ul>
<li>创建 TreeNode 类</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.warehouse.sys.common.entity<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> lombok.AllArgsConstructor<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.Builder<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.Data<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> lombok.NoArgsConstructor<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.util.List<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * @program: warehouse
</span><span style="color:#75715e"> * @description: 菜单数据节点实体类
</span><span style="color:#75715e"> * @author: Dawn
</span><span style="color:#75715e"> * @create: 2020-02-26 18:46
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Data</span>
<span style="color:#a6e22e">@Builder</span>
<span style="color:#a6e22e">@AllArgsConstructor</span>
<span style="color:#a6e22e">@NoArgsConstructor</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TreeNode</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> Integer id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Integer pid<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String title<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String icon<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String href<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Boolean spread<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>TreeNode<span style="color:#f92672">&gt;</span> children<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

</code></pre></div><ul>
<li>创建 TreeBuilder 类-构建者模式</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.warehouse.sys.common.utils<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.warehouse.sys.common.entity.TreeNode<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.util.ArrayList<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.List<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * @program: warehouse
</span><span style="color:#75715e"> * @description: 构建模式处理菜单节点数据
</span><span style="color:#75715e"> * @author: Dawn
</span><span style="color:#75715e"> * @create: 2020-02-26 18:52
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TreeNodeBuilder</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> List<span style="color:#f92672">&lt;</span>TreeNode<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;</span>TreeNode<span style="color:#f92672">&gt;</span> treeNodes<span style="color:#f92672">,</span> Integer pid<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>TreeNode<span style="color:#f92672">&gt;</span> list <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>

        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>TreeNode n1 <span style="color:#f92672">:</span> treeNodes<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// 第一遍循环查找一级菜单
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>n1<span style="color:#f92672">.</span><span style="color:#a6e22e">getPid</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>pid<span style="color:#f92672">))</span>
                list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>n1<span style="color:#f92672">);</span>
            <span style="color:#75715e">// 第二遍循环查找二级菜单
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>TreeNode n2 <span style="color:#f92672">:</span> treeNodes<span style="color:#f92672">)</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>n2<span style="color:#f92672">.</span><span style="color:#a6e22e">getPid</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>n1<span style="color:#f92672">.</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">()))</span>
                    <span style="color:#75715e">// 找到则添加到一级菜单的子节点
</span><span style="color:#75715e"></span>                    n1<span style="color:#f92672">.</span><span style="color:#a6e22e">getChildren</span><span style="color:#f92672">().</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>n2<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">return</span> list<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><h4 id="244-创建-menucontroller">2.4.4. 创建 MenuController</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.warehouse.sys.controller<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.common.constants.DataSourcesConstants<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.common.constants.WebConstants<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.common.entity.DataGridView<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.common.entity.TreeNode<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.common.utils.TreeNodeBuilder<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.common.utils.WebUtils<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.entity.Permission<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.entity.User<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.service.IPermissionService<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.vo.PermissionVo<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Autowired<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.GetMapping<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RequestMapping<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RestController<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.util.ArrayList<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.List<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * @program: warehouse
</span><span style="color:#75715e"> * @description: 菜单控制器
</span><span style="color:#75715e"> * @author: Dawn
</span><span style="color:#75715e"> * @create: 2020-02-25 21:04
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@RestController</span>
<span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/menu&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MenuController</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Autowired</span>
    <span style="color:#66d9ef">private</span> IPermissionService permissionService<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@GetMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/loadLeftMenuJson&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> DataGridView <span style="color:#a6e22e">loadLeftMenuJson</span><span style="color:#f92672">(</span>PermissionVo permissionVo<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

        <span style="color:#75715e">// 获取当前用户的信息
</span><span style="color:#75715e"></span>        User user <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>User<span style="color:#f92672">)</span> WebUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span>WebConstants<span style="color:#f92672">.</span><span style="color:#a6e22e">USER_ATTRIBUTE</span><span style="color:#f92672">);</span>

        <span style="color:#75715e">// 构建查询语句
</span><span style="color:#75715e"></span>        QueryWrapper<span style="color:#f92672">&lt;</span>Permission<span style="color:#f92672">&gt;</span> wrapper <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> QueryWrapper<span style="color:#f92672">&lt;&gt;();</span>

        <span style="color:#75715e">// sys_permission表中包含权限和菜单，这里只查询菜单数据
</span><span style="color:#75715e"></span>        wrapper<span style="color:#f92672">.</span><span style="color:#a6e22e">eq</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;type&#34;</span><span style="color:#f92672">,</span> DataSourcesConstants<span style="color:#f92672">.</span><span style="color:#a6e22e">SYS_PERMISSION_TYPE_MENU</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">// 数据可用状态
</span><span style="color:#75715e"></span>        wrapper<span style="color:#f92672">.</span><span style="color:#a6e22e">eq</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;available&#34;</span><span style="color:#f92672">,</span> DataSourcesConstants<span style="color:#f92672">.</span><span style="color:#a6e22e">AVAILABLE_TRUE</span><span style="color:#f92672">);</span>

        <span style="color:#75715e">// 查询
</span><span style="color:#75715e"></span>        List<span style="color:#f92672">&lt;</span>Permission<span style="color:#f92672">&gt;</span> menu <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#75715e">// 判断用户类型
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>DataSourcesConstants<span style="color:#f92672">.</span><span style="color:#a6e22e">USER_TYPE_SUPER</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>user<span style="color:#f92672">.</span><span style="color:#a6e22e">getType</span><span style="color:#f92672">()))</span>
            <span style="color:#75715e">// 是超级管理员则直接查询
</span><span style="color:#75715e"></span>            menu <span style="color:#f92672">=</span> permissionService<span style="color:#f92672">.</span><span style="color:#a6e22e">list</span><span style="color:#f92672">(</span>wrapper<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// 不是超级管理员则按照用户-角色-权限查询
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// 代码待完善
</span><span style="color:#75715e"></span>            permissionService<span style="color:#f92672">.</span><span style="color:#a6e22e">list</span><span style="color:#f92672">(</span>wrapper<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">// 把permission数据转成有层次结构的菜单
</span><span style="color:#75715e"></span>        List<span style="color:#f92672">&lt;</span>TreeNode<span style="color:#f92672">&gt;</span> finalMenu <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>menu <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> menu<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// 初始化菜单节点
</span><span style="color:#75715e"></span>            List<span style="color:#f92672">&lt;</span>TreeNode<span style="color:#f92672">&gt;</span> nodes <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
            menu<span style="color:#f92672">.</span><span style="color:#a6e22e">forEach</span><span style="color:#f92672">(</span>i <span style="color:#f92672">-&gt;</span>
                    <span style="color:#75715e">// 此处使用了lombok提供的builder初始化方法
</span><span style="color:#75715e"></span>                    nodes<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>TreeNode<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
                            <span style="color:#f92672">.</span><span style="color:#a6e22e">id</span><span style="color:#f92672">(</span>i<span style="color:#f92672">.</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">())</span>
                            <span style="color:#f92672">.</span><span style="color:#a6e22e">pid</span><span style="color:#f92672">(</span>i<span style="color:#f92672">.</span><span style="color:#a6e22e">getPid</span><span style="color:#f92672">())</span>
                            <span style="color:#f92672">.</span><span style="color:#a6e22e">title</span><span style="color:#f92672">(</span>i<span style="color:#f92672">.</span><span style="color:#a6e22e">getTitle</span><span style="color:#f92672">())</span>
                            <span style="color:#f92672">.</span><span style="color:#a6e22e">icon</span><span style="color:#f92672">(</span>i<span style="color:#f92672">.</span><span style="color:#a6e22e">getIcon</span><span style="color:#f92672">())</span>
                            <span style="color:#f92672">.</span><span style="color:#a6e22e">href</span><span style="color:#f92672">(</span>i<span style="color:#f92672">.</span><span style="color:#a6e22e">getHref</span><span style="color:#f92672">())</span>
                            <span style="color:#75715e">// 菜单是否展开
</span><span style="color:#75715e"></span>                            <span style="color:#f92672">.</span><span style="color:#a6e22e">spread</span><span style="color:#f92672">(</span>i<span style="color:#f92672">.</span><span style="color:#a6e22e">getOpen</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>DataSourcesConstants<span style="color:#f92672">.</span><span style="color:#a6e22e">MENU_OPEN</span><span style="color:#f92672">))</span>
                            <span style="color:#f92672">.</span><span style="color:#a6e22e">children</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;())</span>
                            <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">())</span>
            <span style="color:#f92672">);</span>
            <span style="color:#75715e">// 排列菜单层次
</span><span style="color:#75715e"></span>            finalMenu <span style="color:#f92672">=</span> TreeNodeBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>nodes<span style="color:#f92672">,</span> 1<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> DataGridView<span style="color:#f92672">(</span>finalMenu<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><h4 id="245-修改前台页面">2.4.5. 修改前台页面</h4>
<ul>
<li>改变前台请求菜单数据的 url</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/menu/loadLeftMenuJson&#34;</span>; <span style="color:#75715e">//获取菜单json地址
</span></code></pre></div><ul>
<li>由于我们封装了菜单数据，取值的对象要更改一下</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">dataStr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">data</span>;
</code></pre></div><p>测试成功：</p>
<!-- raw HTML omitted -->
<hr>
<h3 id="25-修改登录后工作台">2.5. 修改登录后工作台</h3>
<p>由于 index 页面是通过 iframe 请求工作台 main 页面，工作台上方有一个欢迎栏需要用户姓名的数据，于是尝试引入 thymeleaf 标签，把工作台页面<code>page/main.html</code>转移到项目的 templates 下(修改页面里所有的静态资源引用路径&ndash;后面不再赘述这一步骤)，再修改 index 页面的工作台请求路径，在<code>SystemController</code>中添加路径</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 跳转到工作台
</span><span style="color:#75715e">     * */</span>
    <span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/toDesktop&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toDesktop</span><span style="color:#f92672">(){</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;system/main/main&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
</code></pre></div><p>在 main 页面引用的 js 文件中添加</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">//获取登录用户名
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">loginUserName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;[[${session.user.name}]]&#34;</span>;
</code></pre></div><p>来获取登录用户的姓名，失败</p>
<p><img src="https://i.loli.net/2020/02/28/9gof6ER7aJBbcIK.png" alt="image.png"></p>
<p>然后我意识到 js 是在浏览器端运行的代码，<strong>session 是保存在服务器中的</strong>所以不能这样引用，解决方案是把工作台引用的<code>main.js</code>中的 js 代码直接复制到页面中，这样模版引擎才能够生效</p>
<p>成功</p>
<p><img src="https://i.loli.net/2020/02/28/nqfrwKx5VRshdCU.png" alt="image.png"></p>
<hr>
<h3 id="26-日志管理系统">2.6. 日志管理系统</h3>
<p>日志信息的增删查改</p>
<h4 id="261-生成代码">2.6.1. 生成代码</h4>
<p>同上</p>
<h4 id="262-编写-loglogincontroller">2.6.2. 编写 LogLoginController</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * @description: 查询登录信息
</span><span style="color:#75715e">     * @param: logLoginVo
</span><span style="color:#75715e">     * @return: com.warehouse.sys.common.entity.DataGridView
</span><span style="color:#75715e">     * @author: Dawn
</span><span style="color:#75715e">     * @date: 2020/2/28 18:08
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/loadAllLog&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> DataGridView <span style="color:#a6e22e">loadAllLog</span><span style="color:#f92672">(</span>LogLoginVo logLoginVo<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

        Page<span style="color:#f92672">&lt;</span>LogLogin<span style="color:#f92672">&gt;</span> logLoginPage <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Page<span style="color:#f92672">&lt;&gt;(</span>logLoginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getPage</span><span style="color:#f92672">(),</span> logLoginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getLimit</span><span style="color:#f92672">());</span>
        QueryWrapper<span style="color:#f92672">&lt;</span>LogLogin<span style="color:#f92672">&gt;</span> wrapper <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> QueryWrapper<span style="color:#f92672">&lt;&gt;();</span>

        <span style="color:#75715e">// 添加查询条件，按照登录名查询
</span><span style="color:#75715e"></span>        wrapper<span style="color:#f92672">.</span><span style="color:#a6e22e">like</span><span style="color:#f92672">(</span>StringUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">isNotBlank</span><span style="color:#f92672">(</span>logLoginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getLoginname</span><span style="color:#f92672">()),</span>
                <span style="color:#e6db74">&#34;loginname&#34;</span><span style="color:#f92672">,</span> logLoginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getLoginname</span><span style="color:#f92672">());</span>
        <span style="color:#75715e">// 按照登录IP查询
</span><span style="color:#75715e"></span>        wrapper<span style="color:#f92672">.</span><span style="color:#a6e22e">like</span><span style="color:#f92672">(</span>StringUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">isNotBlank</span><span style="color:#f92672">(</span>logLoginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getLoginip</span><span style="color:#f92672">()),</span>
                <span style="color:#e6db74">&#34;loginip&#34;</span><span style="color:#f92672">,</span> logLoginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getLoginip</span><span style="color:#f92672">());</span>
        <span style="color:#75715e">// 按照登录时间范围查询
</span><span style="color:#75715e"></span>        wrapper<span style="color:#f92672">.</span><span style="color:#a6e22e">ge</span><span style="color:#f92672">(</span>logLoginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getStartTime</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span>
                <span style="color:#e6db74">&#34;logintime&#34;</span><span style="color:#f92672">,</span> logLoginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getStartTime</span><span style="color:#f92672">());</span>
        wrapper<span style="color:#f92672">.</span><span style="color:#a6e22e">le</span><span style="color:#f92672">(</span>logLoginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getEndTime</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span>
                <span style="color:#e6db74">&#34;logintime&#34;</span><span style="color:#f92672">,</span> logLoginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getEndTime</span><span style="color:#f92672">());</span>
        <span style="color:#75715e">// 按照登录时间排序，新登陆的在前面
</span><span style="color:#75715e"></span>        wrapper<span style="color:#f92672">.</span><span style="color:#a6e22e">orderByDesc</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;logintime&#34;</span><span style="color:#f92672">);</span>

        logLoginService<span style="color:#f92672">.</span><span style="color:#a6e22e">page</span><span style="color:#f92672">(</span>logLoginPage<span style="color:#f92672">,</span> wrapper<span style="color:#f92672">);</span>

        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> DataGridView<span style="color:#f92672">(</span>logLoginPage<span style="color:#f92672">.</span><span style="color:#a6e22e">getTotal</span><span style="color:#f92672">(),</span> logLoginPage<span style="color:#f92672">.</span><span style="color:#a6e22e">getRecords</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * @description: 按照id删除登陆日志信息
</span><span style="color:#75715e">     * @param: id
</span><span style="color:#75715e">     * @return: com.warehouse.sys.common.entity.ResultObj
</span><span style="color:#75715e">     * @author: Dawn
</span><span style="color:#75715e">     * @date: 2020/2/29 13:26
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/deleteLogLogin&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> ResultObj <span style="color:#a6e22e">deleteLogLogin</span><span style="color:#f92672">(</span>Integer id<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">boolean</span> removeSuccess <span style="color:#f92672">=</span> logLoginService<span style="color:#f92672">.</span><span style="color:#a6e22e">removeById</span><span style="color:#f92672">(</span>id<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>removeSuccess<span style="color:#f92672">)</span>
                <span style="color:#66d9ef">return</span> ResultObj<span style="color:#f92672">.</span><span style="color:#a6e22e">DELETE_SUCCESS</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">else</span>
                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Exception<span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">return</span> ResultObj<span style="color:#f92672">.</span><span style="color:#a6e22e">DELETE_ERROR</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * @description: 批量删除
</span><span style="color:#75715e">     * @param: loginVo
</span><span style="color:#75715e">     * @return: com.warehouse.sys.common.entity.ResultObj
</span><span style="color:#75715e">     * @author: Dawn
</span><span style="color:#75715e">     * @date: 2020/2/29 13:44
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/batchDeleteLog&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> ResultObj <span style="color:#a6e22e">batchDeleteLog</span><span style="color:#f92672">(</span>LogLoginVo loginVo<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            ArrayList<span style="color:#f92672">&lt;</span>Integer<span style="color:#f92672">&gt;</span> logIds <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
            Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">addAll</span><span style="color:#f92672">(</span>logIds<span style="color:#f92672">,</span> loginVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getIds</span><span style="color:#f92672">());</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ids = &#34;</span> <span style="color:#f92672">+</span> logIds<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
            <span style="color:#66d9ef">boolean</span> removeSuccess <span style="color:#f92672">=</span> logLoginService<span style="color:#f92672">.</span><span style="color:#a6e22e">removeByIds</span><span style="color:#f92672">(</span>logIds<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>removeSuccess<span style="color:#f92672">)</span>
                <span style="color:#66d9ef">return</span> ResultObj<span style="color:#f92672">.</span><span style="color:#a6e22e">DELETE_SUCCESS</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">else</span>
                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Exception<span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">return</span> ResultObj<span style="color:#f92672">.</span><span style="color:#a6e22e">DELETE_ERROR</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
</code></pre></div><h4 id="263-前台页面和-js">2.6.3. 前台页面和 js</h4>
<p>新建 templates/system/main/logManager.html</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">body</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;childrenBody&#34;</span>&gt;
  <span style="color:#75715e">&lt;!-- 查询条件开始 --&gt;</span>

  &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">lay-filter</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;searchForm&#34;</span>&gt;
    &lt;<span style="color:#f92672">blockquote</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-elem-quote&#34;</span>&gt;
      &lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;searchForm&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-form&#34;</span>&gt;
        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-form-item&#34;</span>&gt;
          &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-inline&#34;</span>&gt;
            &lt;<span style="color:#f92672">label</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-form-label&#34;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width: 80px;&#34;</span>&gt;登录名&lt;/<span style="color:#f92672">label</span>&gt;
            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-input-inline&#34;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width: 100px;&#34;</span>&gt;
              &lt;<span style="color:#f92672">input</span>
                <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span>
                <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;loginname&#34;</span>
                <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;loginname&#34;</span>
                <span style="color:#a6e22e">autocomplete</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;off&#34;</span>
                <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-input&#34;</span>
              /&gt;
            &lt;/<span style="color:#f92672">div</span>&gt;
          &lt;/<span style="color:#f92672">div</span>&gt;
          &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-inline&#34;</span>&gt;
            &lt;<span style="color:#f92672">label</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-form-label&#34;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width: 80px;&#34;</span>&gt;登录IP&lt;/<span style="color:#f92672">label</span>&gt;
            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-input-inline&#34;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width: 100px;&#34;</span>&gt;
              &lt;<span style="color:#f92672">input</span>
                <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span>
                <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;loginip&#34;</span>
                <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;loginip&#34;</span>
                <span style="color:#a6e22e">autocomplete</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;off&#34;</span>
                <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-input&#34;</span>
              /&gt;
            &lt;/<span style="color:#f92672">div</span>&gt;
          &lt;/<span style="color:#f92672">div</span>&gt;
          &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-inline&#34;</span>&gt;
            &lt;<span style="color:#f92672">label</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-form-label&#34;</span>&gt;开始时间&lt;/<span style="color:#f92672">label</span>&gt;
            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-input-inline&#34;</span>&gt;
              &lt;<span style="color:#f92672">input</span>
                <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span>
                <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;startTime&#34;</span>
                <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;startTime&#34;</span>
                <span style="color:#a6e22e">lay-verify</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;datetime&#34;</span>
                <span style="color:#a6e22e">readonly</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;readonly&#34;</span>
                <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;年-月-日 时:分:秒&#34;</span>
                <span style="color:#a6e22e">autocomplete</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;off&#34;</span>
                <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-input&#34;</span>
              /&gt;
            &lt;/<span style="color:#f92672">div</span>&gt;
          &lt;/<span style="color:#f92672">div</span>&gt;
          &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-inline&#34;</span>&gt;
            &lt;<span style="color:#f92672">label</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-form-label&#34;</span>&gt;结束时间&lt;/<span style="color:#f92672">label</span>&gt;
            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-input-inline&#34;</span>&gt;
              &lt;<span style="color:#f92672">input</span>
                <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span>
                <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;endTime&#34;</span>
                <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;endTime&#34;</span>
                <span style="color:#a6e22e">lay-verify</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;datetime&#34;</span>
                <span style="color:#a6e22e">readonly</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;readonly&#34;</span>
                <span style="color:#a6e22e">placeholder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;年-月-日 时:分:秒&#34;</span>
                <span style="color:#a6e22e">autocomplete</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;off&#34;</span>
                <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-input&#34;</span>
              /&gt;
            &lt;/<span style="color:#f92672">div</span>&gt;
          &lt;/<span style="color:#f92672">div</span>&gt;
          &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-form-item&#34;</span>&gt;
            &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-input-block&#34;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-align:center&#34;</span>&gt;
              &lt;<span style="color:#f92672">button</span>
                <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span>
                <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-btn&#34;</span>
                <span style="color:#a6e22e">lay-submit</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>
                <span style="color:#a6e22e">lay-filter</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;doSearch&#34;</span>
              &gt;
                &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-icon layui-icon-search&#34;</span>&gt;&lt;/<span style="color:#f92672">span</span>&gt;查询
              &lt;/<span style="color:#f92672">button</span>&gt;
              &lt;<span style="color:#f92672">button</span>
                <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;resetBtn&#34;</span>
                <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;reset&#34;</span>
                <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-btn layui-btn-warm&#34;</span>
              &gt;
                &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-icon layui-icon-refresh-1&#34;</span>&gt;&lt;/<span style="color:#f92672">span</span>&gt;重置
              &lt;/<span style="color:#f92672">button</span>&gt;
            &lt;/<span style="color:#f92672">div</span>&gt;
          &lt;/<span style="color:#f92672">div</span>&gt;
        &lt;/<span style="color:#f92672">div</span>&gt;
      &lt;/<span style="color:#f92672">form</span>&gt;
    &lt;/<span style="color:#f92672">blockquote</span>&gt;
  &lt;/<span style="color:#f92672">div</span>&gt;
  <span style="color:#75715e">&lt;!-- 查询条件结束 --&gt;</span>

  <span style="color:#75715e">&lt;!-- 数据表格开始 --&gt;</span>
  &lt;<span style="color:#f92672">div</span>&gt;
    &lt;<span style="color:#f92672">table</span>
      <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-hide&#34;</span>
      <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;logInfoTable&#34;</span>
      <span style="color:#a6e22e">lay-filter</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;logInfoTable&#34;</span>
    &gt;&lt;/<span style="color:#f92672">table</span>&gt;

    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;logInfoToolBar&#34;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;display: none;&#34;</span>&gt;
      &lt;<span style="color:#f92672">button</span>
        <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span>
        <span style="color:#a6e22e">lay-event</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;batchDelete&#34;</span>
        <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-btn layui-btn-sm layui-btn-danger&#34;</span>
      &gt;
        &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-icon layui-icon-delete&#34;</span>&gt;&lt;/<span style="color:#f92672">span</span>&gt;批量删除
      &lt;/<span style="color:#f92672">button</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;

    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;logInfoRowBar&#34;</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;display: none;&#34;</span>&gt;
      &lt;<span style="color:#f92672">button</span>
        <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span>
        <span style="color:#a6e22e">lay-event</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;delete&#34;</span>
        <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-btn layui-btn-sm layui-btn-danger&#34;</span>
      &gt;
        &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-icon layui-icon-delete&#34;</span>&gt;&lt;/<span style="color:#f92672">span</span>&gt;删除
      &lt;/<span style="color:#f92672">button</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
  &lt;/<span style="color:#f92672">div</span>&gt;
  <span style="color:#75715e">&lt;!-- 数据表格结束 --&gt;</span>
  &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/javascript&#34;</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/resources/layui/layui.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
  &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/javascript&#34;</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/resources/js/logManager.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
&lt;/<span style="color:#f92672">body</span>&gt;
</code></pre></div><p>新建 resources/js/logManager.js</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">layui</span>.<span style="color:#a6e22e">use</span>([<span style="color:#e6db74">&#34;table&#34;</span>, <span style="color:#e6db74">&#34;laydate&#34;</span>, <span style="color:#e6db74">&#34;jquery&#34;</span>, <span style="color:#e6db74">&#34;form&#34;</span>, <span style="color:#e6db74">&#34;layer&#34;</span>], <span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">table</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">layui</span>.<span style="color:#a6e22e">table</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">laydate</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">layui</span>.<span style="color:#a6e22e">laydate</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">$</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">layui</span>.<span style="color:#a6e22e">jquery</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">form</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">layui</span>.<span style="color:#a6e22e">form</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">layer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">layui</span>.<span style="color:#a6e22e">layer</span>;

  <span style="color:#75715e">// 控件渲染开始日期
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">laydate</span>.<span style="color:#a6e22e">render</span>({
    <span style="color:#a6e22e">elem</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#startTime&#34;</span>,
    <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;datetime&#34;</span>
  });

  <span style="color:#75715e">// 控件渲染结束日期
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">laydate</span>.<span style="color:#a6e22e">render</span>({
    <span style="color:#a6e22e">elem</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#endTime&#34;</span>,
    <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;datetime&#34;</span>
  });

  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">tableIns</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">table</span>.<span style="color:#a6e22e">render</span>({
    <span style="color:#a6e22e">elem</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#logInfoTable&#34;</span>,
    <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/log-login/loadAllLog&#34;</span>,
    <span style="color:#a6e22e">toolbar</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#logInfoToolBar&#34;</span>, <span style="color:#75715e">//开启头部工具栏，并为其绑定左侧模板
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;登录日志表&#34;</span>,
    <span style="color:#a6e22e">height</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;full-160&#34;</span>,
    <span style="color:#a6e22e">page</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
    <span style="color:#a6e22e">cols</span><span style="color:#f92672">:</span> [
      [
        { <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;checkbox&#34;</span>, <span style="color:#a6e22e">fixed</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;left&#34;</span> },
        { <span style="color:#a6e22e">field</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;id&#34;</span>, <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;id&#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">80</span> },
        { <span style="color:#a6e22e">field</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;loginname&#34;</span>, <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;登陆名称&#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">200</span> },
        { <span style="color:#a6e22e">field</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;loginip&#34;</span>, <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;登录IP&#34;</span> },
        { <span style="color:#a6e22e">field</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;logintime&#34;</span>, <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;登录时间&#34;</span> },
        { <span style="color:#a6e22e">fixed</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;right&#34;</span>, <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;操作&#34;</span>, <span style="color:#a6e22e">toolbar</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#logInfoRowBar&#34;</span>, <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">150</span> }
      ]
    ]
  });

  <span style="color:#75715e">// 按条件搜索查看
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">form</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#34;submit(doSearch)&#34;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>) {
    <span style="color:#a6e22e">tableIns</span>.<span style="color:#a6e22e">reload</span>({
      <span style="color:#a6e22e">where</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">field</span>,
      <span style="color:#a6e22e">page</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">curr</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span> }
    });
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
  });

  <span style="color:#75715e">// 监听表格工具栏
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">table</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#34;toolbar(logInfoTable)&#34;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">obj</span>) {
    <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">event</span>) {
      <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;batchDelete&#34;</span><span style="color:#f92672">:</span>
        <span style="color:#a6e22e">batchDelete</span>();
        <span style="color:#66d9ef">break</span>;
    }
  });

  <span style="color:#75715e">// 监听行工具栏
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">table</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#34;tool(logInfoTable)&#34;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">obj</span>) {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">data</span>; <span style="color:#75715e">//获得当前行数据
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">event</span>) {
      <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;delete&#34;</span><span style="color:#f92672">:</span>
        <span style="color:#a6e22e">deleteRow</span>(<span style="color:#a6e22e">data</span>);
        <span style="color:#66d9ef">break</span>;
    }
  });

  <span style="color:#75715e">// 批量删除函数
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">batchDelete</span>() {
    <span style="color:#75715e">// 获取选中行
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">checkStatus</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">table</span>.<span style="color:#a6e22e">checkStatus</span>(<span style="color:#e6db74">&#34;logInfoTable&#34;</span>);
    <span style="color:#75715e">// 获取选中行的数据
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">checkStatus</span>.<span style="color:#a6e22e">data</span>;
    <span style="color:#75715e">// 获取选中多少行
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">length</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">length</span>;
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
      <span style="color:#75715e">// 选中了内容
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// 删除操作确认
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">layer</span>.<span style="color:#a6e22e">confirm</span>(
        <span style="color:#e6db74">&#34;你确定要删除这些数据吗？该操作不可逆！&#34;</span>,
        { <span style="color:#a6e22e">icon</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">7</span>, <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;警告！&#34;</span> },
        <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">index</span>) {
          <span style="color:#75715e">// 开始封装全部id
</span><span style="color:#75715e"></span>          <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ids</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
          <span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">each</span>(<span style="color:#a6e22e">data</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">item</span>) {
            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">index</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)
              <span style="color:#75715e">// 第一条数据拼接
</span><span style="color:#75715e"></span>              <span style="color:#a6e22e">ids</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;ids=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">id</span>;
            <span style="color:#75715e">// 剩余数据拼接
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">ids</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&amp;ids=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">id</span>;
          });
          <span style="color:#75715e">// 测试能否获取数据
</span><span style="color:#75715e"></span>          <span style="color:#75715e">// layer.msg(ids);
</span><span style="color:#75715e"></span>          <span style="color:#75715e">// alert(ids);
</span><span style="color:#75715e"></span>
          <span style="color:#75715e">// ajax发送批量删除请求
</span><span style="color:#75715e"></span>          <span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#34;/log-login/batchDeleteLog&#34;</span>, <span style="color:#a6e22e">ids</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">result</span>) {
            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">code</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>) {
              <span style="color:#75715e">// 删除成功，重新加载表格
</span><span style="color:#75715e"></span>              <span style="color:#a6e22e">tableIns</span>.<span style="color:#a6e22e">reload</span>();
            }
            <span style="color:#75715e">// 无论删除是否成功都显示信息msg
</span><span style="color:#75715e"></span>            <span style="color:#a6e22e">layer</span>.<span style="color:#a6e22e">msg</span>(<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">msg</span>);
          });
          <span style="color:#a6e22e">layer</span>.<span style="color:#a6e22e">close</span>(<span style="color:#a6e22e">index</span>);
        }
      );
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#75715e">// 没有选中内容
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">layer</span>.<span style="color:#a6e22e">msg</span>(<span style="color:#e6db74">&#34;请先选中行&#34;</span>);
    }
  }

  <span style="color:#75715e">// 删除行函数
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">deleteRow</span>(<span style="color:#a6e22e">data</span>) {
    <span style="color:#a6e22e">layer</span>.<span style="color:#a6e22e">confirm</span>(
      <span style="color:#e6db74">&#34;确定删除这条数据吗？该操作不可逆！&#34;</span>,
      { <span style="color:#a6e22e">icon</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">7</span>, <span style="color:#a6e22e">title</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;警告！&#34;</span> },
      <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">index</span>) {
        <span style="color:#75715e">// 发送单条删除请求
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#34;/log-login/deleteLogLogin&#34;</span>, { <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">id</span> }, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">result</span>) {
          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">code</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>) {
            <span style="color:#75715e">// 删除成功，重新加载表格
</span><span style="color:#75715e"></span>            <span style="color:#a6e22e">tableIns</span>.<span style="color:#a6e22e">reload</span>();
          }
          <span style="color:#75715e">// 无论删除是否成功都显示信息msg
</span><span style="color:#75715e"></span>          <span style="color:#a6e22e">layer</span>.<span style="color:#a6e22e">msg</span>(<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">msg</span>);
        });
      }
    );
  }
});
</code></pre></div><h4 id="264-其它修改">2.6.4. 其它修改</h4>
<ul>
<li>在 SystemController 中添加代码跳转</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 跳转到登录日志管理
</span><span style="color:#75715e">     * */</span>
    <span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/toLogManager&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toLogManager</span><span style="color:#f92672">(){</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;system/main/logManager&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
</code></pre></div><pre><code>  测试后发现如果使用 localhost 访问网站，那么获取到的 IP 是 IPV6 格式的，用 127.0.0.1 访问网站，获取到的 IP 就是 127.0.0.1
</code></pre>
<ul>
<li>
<p>修改数据库中的菜单链接为上面的请求路径</p>
<p>我使用了 IDEA 自带的 Database 插件，发现修改不成功的现象，结果百度才了解到，提交数据表的修改要在修改行右键点击提交，或者 ctrl+enter 提交</p>
</li>
<li>
<p>在登录时为登陆日志表添加数据</p>
<p>在 LoginController 的登录方法中添加代码</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// 填写登录日志
</span><span style="color:#75715e">// 获取日志登录名
</span><span style="color:#75715e"></span>String logLoginname<span style="color:#f92672">=</span>activeUser<span style="color:#f92672">.</span><span style="color:#a6e22e">getUser</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">()+</span><span style="color:#e6db74">&#34;-&#34;</span><span style="color:#f92672">+</span>activeUser<span style="color:#f92672">.</span><span style="color:#a6e22e">getUser</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getLoginname</span><span style="color:#f92672">();</span>
<span style="color:#75715e">// 获取IP
</span><span style="color:#75715e"></span>String remoteHost <span style="color:#f92672">=</span> WebUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequest</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getRemoteAddr</span><span style="color:#f92672">();</span>
LogLogin newLogLogin<span style="color:#f92672">=</span>LogLogin<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">loginname</span><span style="color:#f92672">(</span>logLoginname<span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">loginip</span><span style="color:#f92672">(</span>remoteHost<span style="color:#f92672">)</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">logintime</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> Date<span style="color:#f92672">())</span>
        <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
<span style="color:#75715e">// 保存登录日志
</span><span style="color:#75715e"></span>logLoginService<span style="color:#f92672">.</span><span style="color:#a6e22e">save</span><span style="color:#f92672">(</span>newLogLogin<span style="color:#f92672">);</span>
</code></pre></div><p>测试成功</p>
<p><img src="https://i.loli.net/2020/02/29/9noMeyUd4arkDIV.png" alt="image.png"></p>
<h4 id="265-问题总结">2.6.5. 问题总结</h4>
<blockquote>
<p>自己对 layui 或者应该说整个前端的内容都不算熟，应该花些功夫做做功课，在写 js 文件的时候就闹出很多次页面显示效果不能达到预期的问题，大多原因是对原生 JavaScript、jQuery、layui 的语法掌握不好，都是依靠 <strong>查官方文档</strong> 解决或者 <strong>使用 IDEA 的自动排错</strong> 发现，真的大大降低了开发的效率，应当引以为戒。</p>
</blockquote>
<hr>
<h3 id="27-公告管理系统">2.7. 公告管理系统</h3>
<p>基本和上一个一样，该替换的替换，面向复制粘贴编程(狗头)，下面没有必要就不贴大量源码了</p>
<blockquote>
<p>我们在这里添加一个 layui 的富文本编辑器用来书写公告，但是发现自带的表单提交方法<code>form.on(&quot;submit(doSubmit)&quot;, function(data) {}</code>不能同步富文本内容到表单，导致提交的公告没有内容，于是决定不使用 layui 的表单自带的提交方法，改为使用 jQuery 发送 ajax 请求提交表单，并为富文本添加一个全局变量，在打开添加和修改页面时为它初始化&ndash;这样初始化的目的是因为，<strong>如果定义富文本编辑器全局变量时初始化，打开弹出层之后富文本编辑器的工具栏是不能使用的，所以要在打开弹出层之后再初始化富文本编辑器</strong>，底层原因大概是和 layui 的模块加载顺序有关，我这个 JavaScript 菜鸡暂时做不出太清晰的解释，慢慢学吧</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// 为富文本定义全局变量
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">contentText</span>;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// 初始化富文本编辑器
</span><span style="color:#75715e"></span><span style="color:#a6e22e">contentText</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">layedit</span>.<span style="color:#a6e22e">build</span>(<span style="color:#e6db74">&#34;content&#34;</span>);
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// 同步富文本和textarea里面的内容
</span><span style="color:#75715e"></span><span style="color:#a6e22e">layedit</span>.<span style="color:#a6e22e">sync</span>(<span style="color:#a6e22e">contentText</span>);
</code></pre></div><p>最终效果：</p>
<p><img src="https://i.loli.net/2020/03/09/Q5VURwsItHTAc9F.png" alt="image.png"></p>
<p><img src="https://i.loli.net/2020/03/09/7tSwQngsEdDeTCc.png" alt="image.png"></p>
<p><img src="https://i.loli.net/2020/03/09/xT4dVbHJZzalSAI.png" alt="image.png"></p>
<h3 id="28-部门管理系统">2.8. 部门管理系统</h3>
<blockquote>
<p>我们引入 layui 的拓展插件 dtree：<a href="https://fly.layui.com/extend/dtree/#download">下载地址</a> 、<a href="https://fly.layui.com/extend/dtree/">dtree 官网</a>、<a href="http://www.wisdomelon.com/DTreeHelper/">dtree 组件文档</a>，组件的最终效果如图：</p>
</blockquote>
<p><img src="https://i.loli.net/2020/03/04/7nygfNvLAzTDc4t.png" alt="image.png"></p>
<p>我们解压缩下载的包，只需要里面的 layui_ext 这个文件夹，将其拷贝到项目的静态目录下即可</p>
<p><img src="https://i.loli.net/2020/03/04/Yg6wGUK1loNZEv2.png" alt="image.png"></p>
<p>在页面中引用 dtree 模版除了引入 dtree 自己的样式文件以外，还应使用 extend 语句</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!-- 引入dtree自己的css --&gt;</span>
&lt;<span style="color:#f92672">link</span>
  <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span>
  <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/resources/layui_ext/dtree/dtree.css&#34;</span>
  <span style="color:#a6e22e">media</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;all&#34;</span>
/&gt;
&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/resources/layui_ext/dtree/font/dtreefont.css&#34;</span> /&gt;

<span style="color:#75715e">&lt;!-- body中存放树的容器 --&gt;</span>
&lt;<span style="color:#f92672">ul</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;deptTree&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dtree&#34;</span> <span style="color:#a6e22e">data-id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span>&gt;&lt;/<span style="color:#f92672">ul</span>&gt;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">layui</span>
  .<span style="color:#a6e22e">extend</span>({
    <span style="color:#75715e">// {/}的意思即代表采用自有路径，即不跟随 base 路径
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// 这里填写dtree.js文件所在的位置
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">dtree</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/resources/layui_ext/dtree/dtree&#34;</span>
  })
  .<span style="color:#a6e22e">use</span>([<span style="color:#e6db74">&#34;dtree&#34;</span>], <span style="color:#66d9ef">function</span>() {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">dtree</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">layui</span>.<span style="color:#a6e22e">dtree</span>;
  });
</code></pre></div><p>我们把部门管理页面分为左右两个部分，在 templates/sys/下建立一个 dept 文件夹存放包括 frame 容器在内的三个文件：deptManager.html、deptLeft,html、deptRight.html，以 Manager 页面做 frameset 的容器</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">  <span style="color:#75715e">&lt;!-- 删除body标签，添加frameset --&gt;</span>
  &lt;<span style="color:#f92672">frameset</span> <span style="color:#a6e22e">cols</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;200,*&#34;</span> <span style="color:#a6e22e">border</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">frameborder</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;yes&#34;</span>
    &gt;&lt;<span style="color:#f92672">frame</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/sys/toDeptLeft&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;left&#34;</span>&gt;
    &lt;<span style="color:#f92672">frame</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/sys/toDeptRight&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;right&#34;</span>&gt;
  &lt;/<span style="color:#f92672">frameset</span>&gt;
</code></pre></div><p>在后台添加指向 dept
Manager.html 左右两个 html 的路径</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 跳转到部门管理
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/toDeptManager&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toDeptManager</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;system/dept/deptManager&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 跳转到部门管理-left
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/toDeptLeft&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toDeptLeftManager</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;system/dept/deptLeft&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 跳转到部门管理-right
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/toDeptRight&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toDeptRightManager</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;system/dept/deptRight&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
</code></pre></div><p>接下来编写具体的前台代码就好啦，具体看源码</p>
<blockquote>
<p>layui 的表单验证 <code>lay-verify=&quot;&quot;</code> 只有在自带的表单提交函数触发时 <code>form.on(&quot;submit( any event )&quot;, function(data) {}</code> 才会执行，我们前面在公告管理中为了同步 textarea 标签富文本编辑器添加的 jQuery 表单提交方法会直接执行提交而跳过 layui 的验证</p>
</blockquote>
<p>解决的方案：</p>
<ul>
<li>如果没有同步某些标签内容的必要，请使用 layui 下的表单提交方法；</li>
<li>如果有同步的需要，自己写一个表单验证的 js 方法</li>
</ul>
<p>最终效果：</p>
<p><img src="https://i.loli.net/2020/03/09/mvQqYg7dDOSWcPa.png" alt="image.png"></p>
<p>点击左侧的树结构右边会弹出该部门对应的子部门</p>
<p><img src="https://i.loli.net/2020/03/09/i8W23E9VMc57oua.png" alt="image.png"></p>
<p>点击删除之后弹出的提醒框</p>
<p><img src="https://i.loli.net/2020/03/09/zFDjLawqytpAHeW.png" alt="image.png"></p>
<hr>
<h3 id="29-缓存切面">2.9. 缓存切面</h3>
<p>在 sys 下新建包 cache，创建类 CacheAspect 做切面</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.warehouse.sys.cache<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> com.warehouse.sys.entity.Dept<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> com.warehouse.sys.vo.DeptVo<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.aspectj.lang.ProceedingJoinPoint<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.aspectj.lang.annotation.Around<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.aspectj.lang.annotation.Aspect<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.beans.BeanUtils<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.context.annotation.EnableAspectJAutoProxy<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> org.springframework.stereotype.Component<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.util.HashMap<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.Map<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * @program: warehouse
</span><span style="color:#75715e"> * @description: 缓存切面
</span><span style="color:#75715e"> * @author: Dawn
</span><span style="color:#75715e"> * @create: 2020-03-03 18:58
</span><span style="color:#75715e"> */</span>
<span style="color:#a6e22e">@Aspect</span>
<span style="color:#a6e22e">@Component</span>
<span style="color:#a6e22e">@EnableAspectJAutoProxy</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CacheAspect</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">// 声明一个缓存容器
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> CACHE_CONTAINER <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>

    <span style="color:#75715e">// 声明切面表达式
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String POINTCUT_DEPT_UPDATE <span style="color:#f92672">=</span>
            <span style="color:#e6db74">&#34;execution(* com.warehouse.sys.service.impl.DeptServiceImpl.updateById(..))&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String POINTCUT_DEPT_GET <span style="color:#f92672">=</span>
            <span style="color:#e6db74">&#34;execution(* com.warehouse.sys.service.impl.DeptServiceImpl.getOne(..))&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String POINTCUT_DEPT_REMOVE <span style="color:#f92672">=</span>
            <span style="color:#e6db74">&#34;execution(* com.warehouse.sys.service.impl.DeptServiceImpl.removeById(..))&#34;</span><span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String CACHE_DEPT_PREFIX <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dept:&#34;</span><span style="color:#f92672">;</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * @description: 查询切入
</span><span style="color:#75715e">     * @param: joinPoint
</span><span style="color:#75715e">     * @return: java.lang.Object
</span><span style="color:#75715e">     * @author: Dawn
</span><span style="color:#75715e">     * @date: 2020/3/3 19:30
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Around</span><span style="color:#f92672">(</span>value <span style="color:#f92672">=</span> POINTCUT_DEPT_GET<span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">cacheDeptGet</span><span style="color:#f92672">(</span>ProceedingJoinPoint joinPoint<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Throwable <span style="color:#f92672">{</span>
        <span style="color:#75715e">// 取出第一个参数
</span><span style="color:#75715e"></span>        Integer object <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>Integer<span style="color:#f92672">)</span> joinPoint<span style="color:#f92672">.</span><span style="color:#a6e22e">getArgs</span><span style="color:#f92672">()[</span>0<span style="color:#f92672">];</span>
        <span style="color:#75715e">// 查询缓存中是否有要查询的数据
</span><span style="color:#75715e"></span>        Object res1 <span style="color:#f92672">=</span> CACHE_CONTAINER<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>CACHE_DEPT_PREFIX <span style="color:#f92672">+</span> object<span style="color:#f92672">);</span>
        <span style="color:#75715e">// 有则返回
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">null</span> <span style="color:#f92672">!=</span> res1<span style="color:#f92672">)</span>
            <span style="color:#66d9ef">return</span> res1<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// 没有的话取数据库中查询
</span><span style="color:#75715e"></span>            Dept res2 <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>Dept<span style="color:#f92672">)</span> joinPoint<span style="color:#f92672">.</span><span style="color:#a6e22e">proceed</span><span style="color:#f92672">();</span>
            <span style="color:#75715e">// key值取前缀+数据的id
</span><span style="color:#75715e"></span>            CACHE_CONTAINER<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>CACHE_DEPT_PREFIX <span style="color:#f92672">+</span> res2<span style="color:#f92672">.</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">(),</span> res2<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">return</span> res2<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * @description: 更新同步缓存
</span><span style="color:#75715e">     * @param: joinPoint
</span><span style="color:#75715e">     * @return: java.lang.Object
</span><span style="color:#75715e">     * @author: Dawn
</span><span style="color:#75715e">     * @date: 2020/3/3 19:44
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Around</span><span style="color:#f92672">(</span>value <span style="color:#f92672">=</span> POINTCUT_DEPT_UPDATE<span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">cacheDeptUpdate</span><span style="color:#f92672">(</span>ProceedingJoinPoint joinPoint<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Throwable <span style="color:#f92672">{</span>
        <span style="color:#75715e">// 取出第一个参数
</span><span style="color:#75715e"></span>        DeptVo deptVo <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>DeptVo<span style="color:#f92672">)</span> joinPoint<span style="color:#f92672">.</span><span style="color:#a6e22e">getArgs</span><span style="color:#f92672">()[</span>0<span style="color:#f92672">];</span>
        Boolean updateSuccess <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>Boolean<span style="color:#f92672">)</span> joinPoint<span style="color:#f92672">.</span><span style="color:#a6e22e">proceed</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>updateSuccess<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// 数据库更新成功，更新缓存
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// 取出数据
</span><span style="color:#75715e"></span>            Dept oldDept <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>Dept<span style="color:#f92672">)</span> CACHE_CONTAINER<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>CACHE_DEPT_PREFIX <span style="color:#f92672">+</span> deptVo<span style="color:#f92672">.</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">());</span>
            <span style="color:#75715e">// 如果缓存中没有就new一个
</span><span style="color:#75715e"></span>            Dept newDept <span style="color:#f92672">=</span> oldDept <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">new</span> Dept<span style="color:#f92672">()</span> <span style="color:#f92672">:</span> oldDept<span style="color:#f92672">;</span>
            <span style="color:#75715e">// 复制更新后的数据
</span><span style="color:#75715e"></span>            BeanUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">copyProperties</span><span style="color:#f92672">(</span>deptVo<span style="color:#f92672">,</span> newDept<span style="color:#f92672">);</span>
            <span style="color:#75715e">// 更新数据缓存
</span><span style="color:#75715e"></span>            CACHE_CONTAINER<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>CACHE_DEPT_PREFIX <span style="color:#f92672">+</span> newDept<span style="color:#f92672">.</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">(),</span> newDept<span style="color:#f92672">);</span>

        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> updateSuccess<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * @description: 删除缓存
</span><span style="color:#75715e">     * @param: joinPoint
</span><span style="color:#75715e">     * @return: java.lang.Object
</span><span style="color:#75715e">     * @author: Dawn
</span><span style="color:#75715e">     * @date: 2020/3/3 19:53
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Around</span><span style="color:#f92672">(</span>value <span style="color:#f92672">=</span> POINTCUT_DEPT_REMOVE<span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">cacheDeptRemove</span><span style="color:#f92672">(</span>ProceedingJoinPoint joinPoint<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Throwable <span style="color:#f92672">{</span>
        <span style="color:#75715e">// 取出第一个参数
</span><span style="color:#75715e"></span>        Integer id <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>Integer<span style="color:#f92672">)</span> joinPoint<span style="color:#f92672">.</span><span style="color:#a6e22e">getArgs</span><span style="color:#f92672">()[</span>0<span style="color:#f92672">];</span>
        Boolean removeSuccess <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>Boolean<span style="color:#f92672">)</span> joinPoint<span style="color:#f92672">.</span><span style="color:#a6e22e">proceed</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>removeSuccess<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// 数据库删除成功，移除缓存中的数据
</span><span style="color:#75715e"></span>            CACHE_CONTAINER<span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>CACHE_DEPT_PREFIX <span style="color:#f92672">+</span> id<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> removeSuccess<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>这个切面暂时只是代理了 sys_dept 中的数据，具体的用法以后再说</p>
<hr>
<h3 id="210-菜单管理系统">2.10. 菜单管理系统</h3>
<p>和部门很像啦，复制粘贴替换就好啦</p>
<p>有几个问题在这里需要解决，我们的编辑按钮在点击之后会自动选中的父级节点，可再次点击根节点的时候，父级节点并没有消失，经测试这里的父级节点 id 确实已经替换成了根节点的父级节点 id，但是文字依然显示上一次点击的节点的父级节点，查阅文档后发现 dtree 的下拉树有一个重置选中节点的方法<code>selectResetVal()</code>，那么只需要在打开弹出层成功后执行一次重置即可。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// 每次打开重置下拉树的节点选择
</span><span style="color:#75715e"></span><span style="color:#a6e22e">selectTree</span>.<span style="color:#a6e22e">selectResetVal</span>();
</code></pre></div><p>在删除菜单时要注意角色数据是依赖于菜单的，我们也要删除所有和该菜单对应的角色菜单关系数据，我们在后台删除菜单调用的是<code>pemissionService.removeById()</code>的方法，这里我们打开实现类重写这个方法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">removeById</span><span style="color:#f92672">(</span>Serializable id<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// 删除角色权限关系表中的pid对应的所有数据
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> deleteById <span style="color:#f92672">=</span> baseMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">deleteRolePermissionByPid</span><span style="color:#f92672">(</span>id<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">removeById</span><span style="color:#f92672">(</span>id<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
</code></pre></div><p>在 Mapper 中新添这个<code>deleteRolePermissionByPid(Serializable pid)</code>方法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">deleteRolePermissionByPid</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Param</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;pid&#34;</span><span style="color:#f92672">)</span> Serializable pid<span style="color:#f92672">);</span>
</code></pre></div><p>PermissionMapper.xml 实现</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">    <span style="color:#f92672">&lt;update</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;deleteRolePermissionByPid&#34;</span><span style="color:#f92672">&gt;</span>
        delete from sys_role_permission where pid=#{pid}
    <span style="color:#f92672">&lt;/update&gt;</span>
</code></pre></div><p>删除表格内容时会碰到这样的情况，删除了最后一页的唯一一个数据，表格应该刷新数据并跳转到前一页，我们需要在 js 渲染表格的代码后加上这一段</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">tableIns</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">table</span>.<span style="color:#a6e22e">render</span>({
  <span style="color:#75715e">// 当删除本页最后一个数据时需要把页面向前加载一页
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">done</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">curr</span>, <span style="color:#a6e22e">count</span>) {
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">curr</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span>)
      <span style="color:#a6e22e">tableIns</span>.<span style="color:#a6e22e">reload</span>({
        <span style="color:#a6e22e">page</span><span style="color:#f92672">:</span> {
          <span style="color:#a6e22e">curr</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">curr</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
        }
      });
  }
});
</code></pre></div><p>最终效果：</p>
<p><img src="https://i.loli.net/2020/03/09/zmHpx1g3niSUPWB.png" alt="image.png"></p>
<p>重复功能不再一一上图</p>
<hr>
<h3 id="211-权限管理系统">2.11. 权限管理系统</h3>
<p>和菜单管理很像，数据库查询时修改查询 type 为 permission 即可</p>
<p>最终效果：</p>
<p><img src="https://i.loli.net/2020/03/09/K2JCRIqvrQWiuVz.png" alt="image.png"></p>
<hr>
<h3 id="212-角色管理系统">2.12. 角色管理系统</h3>
<p>当你真的搭建完之后……你也就不想写开发日志了……下面我尽量吧……有时间再说</p>
<p>最终效果：</p>
<p><img src="https://i.loli.net/2020/03/09/c7WkPwEqn5CGIDL.png" alt="image.png"></p>
<p>为角色分配权限：</p>
<p><img src="https://i.loli.net/2020/03/09/8MLiTNj7OxJ3hgm.png" alt="image.png"></p>
<hr>
<h3 id="213-用户管理系统">2.13. 用户管理系统</h3>
<p>最终效果：</p>
<p>王五登录后的菜单没有全部的功能</p>
<p><img src="https://i.loli.net/2020/03/09/gRF4EnKH3mzkMe2.png" alt="image.png"></p>
<p>在 html 中添加 shiro 和 thymeleaf 的标签</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">html</span>
  <span style="color:#a6e22e">xmlns:th</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.thymeleaf.org&#34;</span>
  <span style="color:#a6e22e">xmlns:shiro</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.pollix.at/thymeleaf/shiro&#34;</span>
&gt;&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><p>然后在按钮上添加<code>shiro:hasPermission=&quot;user:update&quot;</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">button</span>
  <span style="color:#a6e22e">shiro:hasPermission</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;user:update&#34;</span>
  <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;button&#34;</span>
  <span style="color:#a6e22e">lay-event</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;edit&#34;</span>
  <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-btn layui-btn-sm layui-btn-warm&#34;</span>
&gt;
  &lt;<span style="color:#f92672">span</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;layui-icon layui-icon-edit&#34;</span>&gt;&lt;/<span style="color:#f92672">span</span>&gt;编辑
&lt;/<span style="color:#f92672">button</span>&gt;
</code></pre></div><p>举例：我们用超级管理员登录给王五的基础数据管理角色去掉<strong>添加用户</strong>和<strong>编辑用户</strong>的权限，王五登录后就没有<strong>添加用户</strong>和<strong>编辑用户</strong>的按钮了</p>
<p><img src="https://i.loli.net/2020/03/09/go7A3Knde6jhQfD.png" alt="image.png"></p>
<hr>
<blockquote>
<p>有时间我再看看，完善一下开发日志……(摸了摸了)拜拜！</p>
</blockquote>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>Dawn </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://dawn666y.github.io/2020/%E4%B8%80%E4%B8%AA%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/>https://dawn666y.github.io/2020/%E4%B8%80%E4%B8%AA%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://dawn666y.github.io/tags/spring-boot/">
                    #spring boot</a></span>
            
            <span class="tag"><a href="https://dawn666y.github.io/tags/shiro/">
                    #shiro</a></span>
            
            <span class="tag"><a href="https://dawn666y.github.io/tags/thymeleaf/">
                    #thymeleaf</a></span>
            
            <span class="tag"><a href="https://dawn666y.github.io/tags/layui/">
                    #layui</a></span>
            
            <span class="tag"><a href="https://dawn666y.github.io/tags/mybatis-plus/">
                    #mybatis plus</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://dawn666y.github.io/">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://dawn666y.github.io/2020/%E4%BD%BF%E7%94%A8hugo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" class="prev" rel="prev" title="使用hugo搭建个人博客"><i class="iconfont icon-left"></i>&nbsp;使用hugo搭建个人博客</a>
         
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2020 - 2020</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://dawn666y.github.io/">Dawn</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
